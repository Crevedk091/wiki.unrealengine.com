<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wiki.unrealengine.com</title>
    <meta name="description" content="A static site pulled from the internet archive">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css" as="style"><link rel="preload" href="/wiki.unrealengine.com/assets/js/app.aaf63946.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/2.4f53495e.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/1109.0e7aea56.js" as="script">
    <link rel="stylesheet" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki.unrealengine.com/" class="home-link router-link-active"><!----> <span class="site-name">wiki.unrealengine.com</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="content__default"><p>UE4与WEB服务器交互(json) - Epic Wiki</p> <h1 id="ue4与web服务器交互-json"><a href="#ue4与web服务器交互-json" class="header-anchor">#</a> UE4与WEB服务器交互(json)</h1> <p><strong>Rate this Article:</strong></p> <p>3.75</p> <p><img src="/extensions/VoteNY/images/star_on.gif" alt=""><img src="/extensions/VoteNY/images/star_on.gif" alt=""><img src="/extensions/VoteNY/images/star_on.gif" alt=""><img src="/extensions/VoteNY/images/star_half.gif" alt=""><img src="/extensions/VoteNY/images/star_off.gif" alt=""> (4 votes)</p> <p>Approved for Versions:(4.1)</p> <h2 id="contents"><a href="#contents" class="header-anchor">#</a> Contents</h2> <ul><li><a href="#.E6.A6.82.E8.BF.B0">1 概述</a></li> <li><a href="#.E6.B7.BB.E5.8A.A0.E6.A8.A1.E5.9D.97.E5.92.8C.E5.A4.B4.E6.96.87.E4.BB.B6.E5.BC.95.E7.94.A8">2 添加模块和头文件引用</a></li> <li><a href="#.E5.88.9B.E5.BB.BAjson.E6.95.B0.E6.8D.AE.E5.8C.85">3 创建json数据包</a></li> <li><a href="#.E5.87.86.E5.A4.87.E6.8E.A5.E6.94.B6json.E6.95.B0.E6.8D.AE.E5.8C.85.E7.9A.84PHP.E7.BD.91.E9.A1.B5">4 准备接收json数据包的PHP网页</a></li> <li><a href="#POST.E6.95.B0.E6.8D.AE">5 POST数据</a></li> <li><a href="#.E6.80.BB.E7.BB.93">6 总结</a></li> <li><a href="#.E5.B8.B8.E8.A7.81.E9.97.AE.E9.A2.98.E5.8F.8A.E5.8F.82.E8.80.83">7 常见问题及参考</a></li></ul> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>制作游戏在很多情况下需要和WEB服务器进行交互，最常见的是在做Demo时需要通过游戏向WEB服务器传递数据（登录/注册验请求），WEB服务器处理（操作数据库）之后返回结果并调用指定的方法。 该教程简单介绍了如何通过UE4向WEB服务器（PHP）发送json数据包及回调方法。</p> <h2 id="添加模块和头文件引用"><a href="#添加模块和头文件引用" class="header-anchor">#</a> 添加模块和头文件引用</h2> <p>在代码编辑器中打开项目解决方案，在<Solution Name="">/Source/<ProjectName>路径下，找到并打开<ProjectName>.Build.cs文件，添加HTTP模块：</ProjectName></ProjectName></Solution></p> <p>PrivateDependencyModuleNames.AddRange(new string[] {&quot;HTTP&quot;});
PrivateIncludePathModuleNames.AddRange(new string[] {&quot;HTTP&quot;});</p> <p>然后在需要实现该功能的类文件中添加如下的头文件引用:</p> <p>#include &quot;Http.h&quot;
#include &quot;Json.h&quot;</p> <h2 id="创建json数据包"><a href="#创建json数据包" class="header-anchor">#</a> 创建json数据包</h2> <p>数据内容为：</p> <p>{ &quot;user&quot; : &quot;StormUnited&quot;}</p> <p>创建：</p> <p>// Create a writer and hold it in this FString
FString JsonStr;
TSharedRef&lt; TJsonWriter&lt;TCHAR, TCondensedJsonPrintPolicy&lt;TCHAR&gt; &gt; &gt; JsonWriter = TJsonWriterFactory&lt;TCHAR, TCondensedJsonPrintPolicy&lt;TCHAR&gt; &gt;::Create(&amp;JsonStr);
JsonWriter-&gt;WriteObjectStart();
JsonWriter-&gt;WriteValue(TEXT(&quot;user&quot;), TEXT(&quot;StormUnited&quot;));
JsonWriter-&gt;WriteObjectEnd();
 
// Close the writer and finalize the output such that JsonStr has what we want
JsonWriter-&gt;Close();</p> <p>至此，json数据包准备完成。</p> <h2 id="准备接收json数据包的php网页"><a href="#准备接收json数据包的php网页" class="header-anchor">#</a> 准备接收json数据包的PHP网页</h2> <p>本示例中使用了PHP，你可以选择使用搭建动态网站或者服务器的开源软件，比如说wamp/lamp等在本机上建立一个WEB服务器来解析PHP页面。 创建mywebpage.php文件，并添加如下代码：</p>
&lt;?php
     // 首先接收上传的数据
     $post\_data \= file\_get\_contents('php://input');
     // 解析json字符串
     $obj \= json\_decode($post\_data);
     // 获取包含在Json字符串中的数据
     echo $obj\-&gt;{'user'};
?&gt;
<h2 id="post数据"><a href="#post数据" class="header-anchor">#</a> POST数据</h2> <p>将通过如下的代码将上面准备好的json数据包提交给 <a href="http://localhost/mywebpage.php" target="_blank" rel="noopener noreferrer">http://localhost/mywebpage.php<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>SetHeader：可以设置POST数据的格式</li> <li>SetURL：可以指定用于处理上传数据的链接</li> <li>SetVerb：可以设置POST/PUT/GET</li> <li>SetContentAsString：用于填充上传的数据内容</li> <li>OnProcessRequestComplete().BindUObject 用于指定在发送请求之后的回调方法。</li></ul> <p>TSharedRef&lt;IHttpRequest&gt; HttpRequest = FHttpModule::Get().CreateRequest();
HttpRequest-&gt;SetHeader(TEXT(&quot;Content-Type&quot;), TEXT(&quot;application/json; charset=utf-8&quot;));
HttpRequest-&gt;SetURL(TEXT(&quot;http://localhost/mywebpage.php&quot;));
HttpRequest-&gt;SetVerb(TEXT(&quot;POST&quot;));
HttpRequest-&gt;SetContentAsString(JsonStr);
HttpRequest-&gt;OnProcessRequestComplete().BindUObject(this, &amp;ASUMiniGameMode::HttpCompleteCallback);
HttpRequest-&gt;ProcessRequest();</p> <p>关于回调函数的结构：void HttpCompleteCallback(FHttpRequestPtr Request, FHttpResponsePtr Response, bool bWasSuccessful); 示例：</p> <p>void ASUMiniGameMode::HttpCompleteCallback(FHttpRequestPtr Request, FHttpResponsePtr Response, bool bWasSuccessful)
{
FString MessageBody = &quot;&quot;;
 
// If HTTP fails client-side, this will still be called but with a NULL shared pointer!
if (!Response.IsValid())
{
MessageBody = &quot;{\&quot;success\&quot;:\&quot;Error: Unable to process HTTP Request!\&quot;}&quot;;
}
else if (EHttpResponseCodes::IsOk(Response-&gt;GetResponseCode()))
{
MessageBody = Response-&gt;GetContentAsString();
}
else
{
MessageBody = FString::Printf(TEXT(&quot;{\&quot;success\&quot;:\&quot;HTTP Error: %d\&quot;}&quot;), Response-&gt;GetResponseCode());
}
}</p> <p>一旦发送出请求后肯定会调用HttpCompleteCallback方法，WEB服务器处理的数据结果包含在Response参数中，可以通过Response-&gt;GetContentAsString()来获取返回的字符串，比如在本例中是StormUnited。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>联系我：<a href="/User:Hexcola" title="User:Hexcola">hexcola</a></p> <h2 id="常见问题及参考"><a href="#常见问题及参考" class="header-anchor">#</a> 常见问题及参考</h2> <ul><li><a href="https://answers.unrealengine.com/questions/4383/sending-an-fstring-via-sockets.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/4383/sending-an-fstring-via-sockets.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/4406/need-help-with-json-objects.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/4406/need-help-with-json-objects.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/2830/best-way-to-perform-a-http-request.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/2830/best-way-to-perform-a-http-request.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/3530/does-httprequest-use-httpmanager-by-default.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/3530/does-httprequest-use-httpmanager-by-default.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/2830/best-way-to-perform-a-http-request.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/2830/best-way-to-perform-a-http-request.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/23170/making-http-calls.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/23170/making-http-calls.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/31079/http%E9%80%9A%E4%BF%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/31079/http%E9%80%9A%E4%BF%A1%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/26704/trouble-deserializing-json.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/26704/trouble-deserializing-json.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://answers.unrealengine.com/questions/2830/best-way-to-perform-a-http-request.html" target="_blank" rel="noopener noreferrer">https://answers.unrealengine.com/questions/2830/best-way-to-perform-a-http-request.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Retrieved from &quot;<a href="https://wiki.unrealengine.com/index.php?title=UE4%E4%B8%8EWEB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%A4%E4%BA%92(json)&amp;oldid=12751" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/index.php?title=UE4与WEB服务器交互(json)&amp;oldid=12751<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;</p> <p><a href="/Special:Categories" title="Special:Categories">Categories</a>:</p> <ul><li><a href="/Category:Tutorials" title="Category:Tutorials">Tutorials</a></li> <li><a href="/Category:Code" title="Category:Code">Code</a></li> <li><a href="/Category:Community_Created_Content" title="Category:Community Created Content">Community Created Content</a></li></ul> <p>Hidden category:</p> <ul><li><a href="/Category:Templates" title="Category:Templates">Templates</a></li></ul> <p><img src="https://tracking.unrealengine.com/track.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wiki.unrealengine.com/assets/js/app.aaf63946.js" defer></script><script src="/wiki.unrealengine.com/assets/js/2.4f53495e.js" defer></script><script src="/wiki.unrealengine.com/assets/js/1109.0e7aea56.js" defer></script>
  </body>
</html>
