(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{365:function(e,t,o){"use strict";o.r(t);var r=o(28),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("p",[e._v("Animated Vertex Positions of Character Mesh, How To Obtain Them - Epic Wiki")]),e._v(" "),o("h1",{attrs:{id:"animated-vertex-positions-of-character-mesh-how-to-obtain-them"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#animated-vertex-positions-of-character-mesh-how-to-obtain-them"}},[e._v("#")]),e._v(" Animated Vertex Positions of Character Mesh, How To Obtain Them")]),e._v(" "),o("p",[o("a",{attrs:{href:"/File:AnimatedVertexLocations3.jpg"}},[o("img",{attrs:{src:"https://d3ar1piqh1oeli.cloudfront.net/0/04/AnimatedVertexLocations3.jpg/900px-AnimatedVertexLocations3.jpg",alt:"AnimatedVertexLocations3.jpg"}})])]),e._v(" "),o("h2",{attrs:{id:"contents"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#contents"}},[e._v("#")]),e._v(" Contents")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"#Overview"}},[e._v("1 Overview")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#Transforming_Vertices_To_World_Space"}},[e._v("2 Transforming Vertices To World Space")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#Velocity_Correction"}},[e._v("3 Velocity Correction")])]),e._v(" "),o("li",[o("a",{attrs:{href:"#Conclusion"}},[e._v("4 Conclusion")])])]),e._v(" "),o("h2",{attrs:{id:"overview"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),o("p",[o("strong",[e._v("Author:")]),e._v(" "),o("a",{attrs:{href:"/User:Rama",title:"User:Rama"}},[e._v("Rama")]),e._v(" ("),o("a",{attrs:{href:"/User_talk:Rama",title:"User talk:Rama"}},[e._v("talk")]),e._v(")")]),e._v(" "),o("p",[e._v("Dear Community,")]),e._v(" "),o("p",[e._v("Here is the C++ code that you can use to obtain animated vertex positions!")]),e._v(" "),o("p",[e._v("This is the code from my free "),o("a",{attrs:{href:"https://forums.unrealengine.com/showthread.php?3851-(39)-Rama-s-Extra-Blueprint-Nodes-for-You-as-a-Plugin-No-C-Required!&p=341965&viewfull=1#post341965",target:"_blank",rel:"noopener noreferrer"}},[e._v("Victory BP Library plugin BP node"),o("OutboundLink")],1),e._v(" that obtains velocity-corrected animated vertex positions for Pawns and Characters!")]),e._v(" "),o("p",[e._v("bool UVictoryBPFunctionLibrary::AnimatedVertex__GetAnimatedVertexLocations(\nUSkeletalMeshComponent* Mesh,\nTArray<FVector>& Locations,\nbool PerformPawnVelocityCorrection\n){\nif(!Mesh || !Mesh->SkeletalMesh)"),o("br"),e._v("\n{\nreturn false;\n}\n \n//~~~~~~~~~~~~~\nLocations.Empty();\n//~~~~~~~~~~~~~\n \nMesh->ComputeSkinnedPositions(Locations);\n \nFTransform ToWorld = Mesh->GetComponentTransform();\nFVector WorldLocation = ToWorld.GetLocation();\n \n//Pawn Velocity Correction\nUPawnMovementComponent* MovementComp = nullptr;\nif(PerformPawnVelocityCorrection)\n{\nAPawn* Pawn = Cast<APawn>(Mesh->GetOwner());\nMovementComp = (Pawn) ? Pawn->GetMovementComponent() : NULL;\n}\nbool DoVelocityCorrection = PerformPawnVelocityCorrection && MovementComp;\n//Pawn Velocity Correction\n \nfor(FVector& EachVertex : Locations)\n{\nEachVertex = WorldLocation + ToWorld.TransformVector(Each);\nif(DoVelocityCorrection)\n{\nEachVertex += MovementComp->Velocity * FApp::GetDeltaTime();\n}\n}\n \nreturn true;\n}")]),e._v(" "),o("h2",{attrs:{id:"transforming-vertices-to-world-space"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#transforming-vertices-to-world-space"}},[e._v("#")]),e._v(" Transforming Vertices To World Space")]),e._v(" "),o("p",[e._v("If you read the API notes on USkinnedMeshComponent::ComputeSkinnedPositions you will see that the vertex positions are obtained in component space.")]),e._v(" "),o("p",[e._v("In order to provide world space postions I have to transform each vertex by the world transform of the skeletal mesh component:")]),e._v(" "),o("p",[e._v("FTransform ToWorld = Mesh->GetComponentTransform();\nFVector WorldLocation = ToWorld.GetLocation();\n \nEachVertex = WorldLocation + ToWorld.TransformVector(Each);")]),e._v(" "),o("h2",{attrs:{id:"velocity-correction"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#velocity-correction"}},[e._v("#")]),e._v(" Velocity Correction")]),e._v(" "),o("p",[e._v("The animated vertex positions obtained by the skeletal mesh are obtained on the CPU thread before the character movement update has occurred for characters, and thus vertices always lag behind if you just use USkinnedMeshComponent::ComputeSkinnedPositions.")]),e._v(" "),o("p",[e._v("I use this code below to add in the tick update from the pawn or character movement component so that animated vertex positions are accurate for moving characters!")]),e._v(" "),o("p",[e._v("if(DoVelocityCorrection)\n{\nEachVertex += MovementComp->Velocity * FApp::GetDeltaTime();\n}")]),e._v(" "),o("h2",{attrs:{id:"conclusion"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),o("p",[e._v("Enjoy!")]),e._v(" "),o("p",[o("a",{attrs:{href:"/User:Rama",title:"User:Rama"}},[e._v("Rama")]),e._v(" ("),o("a",{attrs:{href:"/User_talk:Rama",title:"User talk:Rama"}},[e._v("talk")]),e._v(")")]),e._v(" "),o("p",[e._v('Retrieved from "'),o("a",{attrs:{href:"https://wiki.unrealengine.com/index.php?title=Animated_Vertex_Positions_of_Character_Mesh,_How_To_Obtain_Them&oldid=14793",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://wiki.unrealengine.com/index.php?title=Animated_Vertex_Positions_of_Character_Mesh,_How_To_Obtain_Them&oldid=14793"),o("OutboundLink")],1),e._v('"')]),e._v(" "),o("p",[o("a",{attrs:{href:"/Special:Categories",title:"Special:Categories"}},[e._v("Category")]),e._v(":")]),e._v(" "),o("ul",[o("li",[o("a",{attrs:{href:"/Category:Code",title:"Category:Code"}},[e._v("Code")])])]),e._v(" "),o("p",[o("img",{attrs:{src:"https://tracking.unrealengine.com/track.png",alt:""}})])])}),[],!1,null,null,null);t.default=n.exports}}]);