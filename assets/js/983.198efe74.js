(window.webpackJsonp=window.webpackJsonp||[]).push([[983],{649:function(t,e,r){"use strict";r.r(e);var a=r(28),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[t._v("Simple Portals - Epic Wiki")]),t._v(" "),r("h1",{attrs:{id:"simple-portals"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#simple-portals"}},[t._v("#")]),t._v(" Simple Portals")]),t._v(" "),r("p",[t._v("From Epic Wiki")]),t._v(" "),r("p",[t._v("Jump to: "),r("a",{attrs:{href:"#mw-head"}},[t._v("navigation")]),t._v(", "),r("a",{attrs:{href:"#p-search"}},[t._v("search")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=Template:Rating&action=edit&redlink=1",title:"Template:Rating (page does not exist)"}},[t._v("Template:Rating")])]),t._v(" "),r("h2",{attrs:{id:"contents"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#contents"}},[t._v("#")]),t._v(" Contents")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"#Overview"}},[t._v("1 Overview")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Math"}},[t._v("2 Math")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"#Basic_portals_math_functions"}},[t._v("2.1 Basic portals math functions")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Tracing_portals"}},[t._v("2.2 Tracing portals")])])])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Rendering_portals"}},[t._v("3 Rendering portals")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"#Setup_SceneCaptureComponent2D"}},[t._v("3.1 Setup SceneCaptureComponent2D")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Update_SceneCaptureComponent2D"}},[t._v("3.2 Update SceneCaptureComponent2D")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Optimization"}},[t._v("3.3 Optimization")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Limitations"}},[t._v("3.4 Limitations")])])])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Teleportation"}},[t._v("4 Teleportation")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Momentum"}},[t._v("5 Momentum")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Conclusion"}},[t._v("6 Conclusion")])]),t._v(" "),r("li",[r("a",{attrs:{href:"#Example_project"}},[t._v("7 Example project")])])]),t._v(" "),r("h2",{attrs:{id:"overview"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[t._v("#")]),t._v(" Overview")]),t._v(" "),r("p",[t._v("This tutorial describes how to setup simple portals in Unreal Engine 4. Main purpose is to explain theoretical techniques and cases of portals logic, math, and its usage on practice. And to make you understand all its pros and cons, before you start to developing game about portals. This tutorial uses "),r("strong",[t._v("render to texture")]),t._v(" portals rendering method and "),r("strong",[t._v("blueprints")]),t._v(" programming.")]),t._v(" "),r("h2",{attrs:{id:"math"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#math"}},[t._v("#")]),t._v(" Math")]),t._v(" "),r("p",[t._v("In editor/game you will use portals as simple placeable actors, and link them to each other to make portals pairs - current portal and target portal. Here you need to remember that target portal has the same local axes as current. You can think that target portal should work like current portal, rotated by 180 degrees on Yaw, but this is mistake. It must work like current portal, mirrored by its local X and Y axes.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_math01.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/7/7f/SP_math01.jpg",alt:"SP math01.jpg"}})])]),t._v(" "),r("p",[t._v("Portals look like mirrors, but work like windows. Light ray becomes mirrored after passing through the mirror, but saves original direction after passing through the portal.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_math02.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/c/cd/SP_math02.jpg",alt:"SP math02.jpg"}})])]),t._v(" "),r("h3",{attrs:{id:"basic-portals-math-functions"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#basic-portals-math-functions"}},[t._v("#")]),t._v(" Basic portals math functions")]),t._v(" "),r("p",[t._v("To understand portals math, you need to know how to transform direction and location from current to target portal.")]),t._v(" "),r("p",[t._v("To transform direction, convert it into current portal local space, mirror by X and Y vectors, and convert into world space from target portal.")]),t._v(" "),r("p",[t._v("To transform location, convert it into current portal local space with mirrored X and Y axes, and convert into world space from target portal.")]),t._v(" "),r("p",[t._v("Here is basic portals functions:")]),t._v(" "),r("ul",[r("li",[t._v("PortalConvertDirection - converts specified direction vector from current to target portal.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:Pfb_01.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/7/7a/Pfb_01.jpg",alt:"Pfb 01.jpg"}})])]),t._v(" "),r("ul",[r("li",[t._v("PortalConvertLocation - converts specified location from current to target portal.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:Pfb_02.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/c/c7/Pfb_02.jpg",alt:"Pfb 02.jpg"}})])]),t._v(" "),r("ul",[r("li",[t._v("PortalConvertLocationMirrored - converts specified location from current to target portal as mirrored to target portal.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:Pfb_03.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/6/61/Pfb_03.jpg",alt:"Pfb 03.jpg"}})])]),t._v(" "),r("ul",[r("li",[t._v("PortalConvertRotation - converts specified rotator from current to target portal (converts rotation X and Y vectors as directions, and makes new rotator).")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:Pfb_04.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/2/2b/Pfb_04.jpg",alt:"Pfb 04.jpg"}})])]),t._v(" "),r("ul",[r("li",[t._v("PortalConvertVelocity - converts specified velocity vector with its size from current to target portal.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:Pfb_05.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/0/05/Pfb_05.jpg",alt:"Pfb 05.jpg"}})])]),t._v(" "),r("h3",{attrs:{id:"tracing-portals"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tracing-portals"}},[t._v("#")]),t._v(" Tracing portals")]),t._v(" "),r("p",[t._v("Now, let’s make simple line trace through the portal:")]),t._v(" "),r("ul",[r("li",[t._v("Make line trace from weapon/camera/etc, and check if it hits portal actor;")]),t._v(" "),r("li",[t._v("Convert trace direction to get new trace direction;")]),t._v(" "),r("li",[t._v("Get hit location and convert to get new trace start location;")]),t._v(" "),r("li",[t._v("Calculate new trace end location and make new line trace.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_trace_01.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/c/cb/SP_trace_01.jpg",alt:"SP trace 01.jpg"}})])]),t._v(" "),r("p",[t._v("You will get traces, incoming into current portal, and outgoing from target one with the same hit location and direction.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_trace02.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/3/3e/SP_trace02.jpg",alt:"SP trace02.jpg"}})])]),t._v(" "),r("p",[t._v("Using this in some recursive function allows you to trace through as many portals as you wish.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_trace03.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/8/8f/SP_trace03.jpg",alt:"SP trace03.jpg"}})])]),t._v(" "),r("h2",{attrs:{id:"rendering-portals"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#rendering-portals"}},[t._v("#")]),t._v(" Rendering portals")]),t._v(" "),r("p",[t._v("I know two methods to render portals - render to texture, and render using stencil buffer. For now, I don’t know any way to use stencil buffer in UE4 for that purpose, so, this tutorial describes method of render to texture. Purpose of this method is to render portal view, using scene capture component, relatively to player’s camera and target portal, and map rendered texture to portal surface with screen aligned UVs.")]),t._v(" "),r("h3",{attrs:{id:"setup-scenecapturecomponent2d"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#setup-scenecapturecomponent2d"}},[t._v("#")]),t._v(" Setup SceneCaptureComponent2D")]),t._v(" "),r("p",[t._v("Create blueprint for portal actor and add SceneCaptureComponent2D (SCC) to it. SCC should use global clip plane to cut objects between itself and portal surface, so enable it in project and in SCC settings.")]),t._v(" "),r("p",[t._v("Project Settings:")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_clipplane_project.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/f/f1/SP_clipplane_project.jpg",alt:"SP clipplane project.jpg"}})])]),t._v(" "),r("p",[t._v("SceneCaptureComponent2D:")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_clipplane_SCC.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/f/f8/SP_clipplane_SCC.jpg",alt:"SP clipplane SCC.jpg"}})])]),t._v(" "),r("p",[t._v("Create simple portal material:")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_M_Portal.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/7/70/SP_M_Portal.jpg",alt:"SP M Portal.jpg"}})])]),t._v(" "),r("p",[t._v("Create render target texture, set it as render target for SCC. Create dynamic material instance from portal material and set it’s RT parameter as render target texture.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_SCC_Init.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/b/b9/SP_SCC_Init.jpg",alt:"SP SCC Init.jpg"}})])]),t._v(" "),r("h3",{attrs:{id:"update-scenecapturecomponent2d"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#update-scenecapturecomponent2d"}},[t._v("#")]),t._v(" Update SceneCaptureComponent2D")]),t._v(" "),r("p",[t._v("SCC, or portal camera, should render scene in front of target portal, so you can see it in current portal. As with line trace, here you also need to make 2 operations - convert location and direction from current to target portal:")]),t._v(" "),r("ul",[r("li",[t._v("Set SCC clip plane from target portal location and forward vector;")]),t._v(" "),r("li",[t._v("Get player camera world location and convert with PortalConvertLocation function;")]),t._v(" "),r("li",[t._v("Get player camera rotation and convert with PortalConvertRotation function.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_SCC_Update.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/6/66/SP_SCC_Update.jpg",alt:"SP SCC Update.jpg"}})])]),t._v(" "),r("p",[t._v("With this setup it doesn’t matter how portals oriented in space. It is only limited by your perception.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_SCC_final.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/f/fb/SP_SCC_final.jpg",alt:"SP SCC final.jpg"}})])]),t._v(" "),r("h3",{attrs:{id:"optimization"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#optimization"}},[t._v("#")]),t._v(" Optimization")]),t._v(" "),r("p",[t._v("It’s unnecessary to capture portal view every frame if you can’t see it. So, maybe it would be useful to check if camera is located in front/back of portal surface, and enable/disable scene capture by this condition:")]),t._v(" "),r("ul",[r("li",[t._v("Get player camera world location;")]),t._v(" "),r("li",[t._v("Subtract portal world location from it to get relative location;")]),t._v(" "),r("li",[t._v("Make dot product between relative location and portal forward vector.")]),t._v(" "),r("li",[t._v("Positive result - camera is in front of portal surface, negative - behind it.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_SCCcheck.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/b/be/SP_SCCcheck.jpg",alt:"SP SCCcheck.jpg"}})])]),t._v(" "),r("h3",{attrs:{id:"limitations"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#limitations"}},[t._v("#")]),t._v(" Limitations")]),t._v(" "),r("p",[t._v("To make good quality of portal view its render target resolution must be equal to screen resolution.")]),t._v(" "),r("p",[t._v("There is no anti-aliasing of render target texture, so maybe you need to add some blur/distortion effects to portal material.")]),t._v(" "),r("p",[t._v("Unfortunately, depending on performance, portal view may have a lag.")]),t._v(" "),r("p",[t._v("With this setup you can’t achieve recursive portals rendering, because render target texture mapped on portal surface by screen aligned UV coordinates, and through current portal you can see only current portal. So, try to avoid situations when portals from one pair can be seen through each other.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_recursive.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/d/da/SP_recursive.jpg",alt:"SP recursive.jpg"}})])]),t._v(" "),r("p",[t._v("Almost the same with portals from another portals pair. Lets imagine situation when you can see some objects through 2 portals pairs.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_21.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/a/a7/SP_21.jpg",alt:"SP 21.jpg"}})])]),t._v(" "),r("p",[t._v("This is what you will get in this case:")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_22.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/7/74/SP_22.jpg",alt:"SP 22.jpg"}})])]),t._v(" "),r("p",[t._v("It looks like portal from another pair calculates its view in wrong way. Yes, it’s because portals uses "),r("strong",[t._v("player’s camera")]),t._v(" world coordinates to calculate their view, and it means that portal can be seen only through this camera. Portals doesn’t know that you look at them through other portals or cameras. Well, I think there is nothing impossible with programming, and you can implement how to set any other camera you want to calculate portal view from, for some specific situations. Remember that it is possible to see portal through the player’s camera and some other portal at the same time:")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_23.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/f/fa/SP_23.jpg",alt:"SP 23.jpg"}})])]),t._v(" "),r("p",[t._v("Light cannot pass through portal, and lit meshes will look different during passing. And there is no good way to fix that. You can try some fake lightning, or custom lightning model, or even light source attached to mesh with specific lightning channels.")]),t._v(" "),r("p",[t._v("Well, I think in really near future it will be possible to use some ray tracing rendering method in realtime, and render any portal view without any limits.")]),t._v(" "),r("h2",{attrs:{id:"teleportation"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#teleportation"}},[t._v("#")]),t._v(" Teleportation")]),t._v(" "),r("p",[t._v("When player overlaps current portal surface, you teleport him to target portal. And remember that character must never overlap more than one portal at the same time.")]),t._v(" "),r("p",[t._v("Simplest case here is when portals oriented vertically. This requires some additional offset in destination area, to prevent player from overlapping target portal right after teleportation, and cause teleportation back.")]),t._v(" "),r("p",[t._v("Also, remember that camera has its near clip plane distance = 10 uu, so try to teleport player at least from that distance to prevent portal clipping.")]),t._v(" "),r("p",[t._v("Here you have next options:")]),t._v(" "),r("ul",[r("li",[t._v("Teleport to the center of target portal;")]),t._v(" "),r("li",[t._v("Teleport to “mirrored” location with the same rotation;")]),t._v(" "),r("li",[t._v("Teleport relatively to previous direction.")])]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_telep_01.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/a/a5/SP_telep_01.jpg",alt:"SP telep 01.jpg"}})])]),t._v(" "),r("p",[t._v("It looks like 3rd one is more accurate, because it stores view direction. But in case of player forward vector is parallel to portal surface, it will teleport player into infinity!")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_telep_02.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/4/4b/SP_telep_02.jpg",alt:"SP telep 02.jpg"}})])]),t._v(" "),r("p",[t._v("So, for "),r("strong",[t._v("simple teleportation")]),t._v(" place portals only vertically, like doors or passes, and use teleport to mirrored location.")]),t._v(" "),r("p",[t._v("More difficult situation when portals is freely oriented. In this case you can’t just teleport player to relative location even with additional offset, because he can still overlap target portal.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_telep_03.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/b/b5/SP_telep_03.jpg",alt:"SP telep 03.jpg"}})])]),t._v(" "),r("p",[t._v("Here you need to make some additional calculations to normally fit character's capsule in destination area. For example, trace capsule in destination point, trace again with some offset if it overlapping portal or something else, and so on…")]),t._v(" "),r("p",[t._v("One more advanced case is a smooth teleportation, when the camera can pass first, when player’s mesh appear on the both sides and so on... In this case you need to check portal’s overlapping every tick, track its relative location/rotation, and create a copy of your character on both sides… Well, first of all try to apply transformed coordinates to camera only.")]),t._v(" "),r("p",[t._v("As you can see, all this cases is about simple first person character, and there are many other situations with third person camera, 6-DOF movement and so on...")]),t._v(" "),r("h2",{attrs:{id:"momentum"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#momentum"}},[t._v("#")]),t._v(" Momentum")]),t._v(" "),r("p",[t._v("Momentum (or kinetic energy) must be retained through portals. In simple words - you should store previous velocity before teleportation, and apply transformed velocity after.")]),t._v(" "),r("p",[t._v("During movement, if portals oriented one to another, character’s direction vector and velocity vector are the same before and after teleportation.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_vel_01.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/6/6e/SP_vel_01.jpg",alt:"SP vel 01.jpg"}})])]),t._v(" "),r("p",[t._v("If portals oriented in some different way, direction vector changes during teleportation, but, for some time, velocity vector is still the same, and it affects movement. So, after teleportation, you will see some additional movement to the previous movement direction.")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SP_vel_02.jpg"}},[r("img",{attrs:{src:"https://d26ilriwvtzlb.cloudfront.net/a/a5/SP_vel_02.jpg",alt:"SP vel 02.jpg"}})])]),t._v(" "),r("p",[t._v("To avoid this, you can convert object velocity and try to apply it as new velocity or impulse. I’m didn't get good results with this, but I hope you will go further in this implementation.")]),t._v(" "),r("h2",{attrs:{id:"conclusion"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[t._v("#")]),t._v(" Conclusion")]),t._v(" "),r("p",[t._v("Well, I think today you learned something about portals. Portals is a huge feature. And it is not really hard to understand them, but it is difficult to implement and use. I hope this tutorial will help you to develop, or not develop some good game about portals. 😃")]),t._v(" "),r("h2",{attrs:{id:"example-project"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#example-project"}},[t._v("#")]),t._v(" Example project")]),t._v(" "),r("p",[t._v("In example project you will find:")]),t._v(" "),r("ul",[r("li",[t._v("Example of line tracing through one or more portals pairs;")]),t._v(" "),r("li",[t._v("Example of portal rendering using SceneCaptureComponent2D;")]),t._v(" "),r("li",[t._v("Example of simple teleportation function in character class;")]),t._v(" "),r("li",[t._v("Example of advanced (smooth) teleportation function in character class;")]),t._v(" "),r("li",[t._v("Example of physics actor that can be teleported through portal;")])]),t._v(" "),r("p",[t._v("(4.15.3)")]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=File:SimplePortals.zip",title:"File:SimplePortals.zip"}},[t._v("File:SimplePortals.zip")])]),t._v(" "),r("p",[t._v('Retrieved from "'),r("a",{attrs:{href:"https://wiki.unrealengine.com/index.php?title=Simple_Portals&oldid=341",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://wiki.unrealengine.com/index.php?title=Simple_Portals&oldid=341"),r("OutboundLink")],1),t._v('"')]),t._v(" "),r("p",[r("a",{attrs:{href:"/index.php?title=Special:Categories",title:"Special:Categories"}},[t._v("Category")]),t._v(":")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"/index.php?title=Category:Tutorials&action=edit&redlink=1",title:"Category:Tutorials (page does not exist)"}},[t._v("Tutorials")])])])])}),[],!1,null,null,null);e.default=o.exports}}]);