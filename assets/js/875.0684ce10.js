(window.webpackJsonp=window.webpackJsonp||[]).push([[875],{1390:function(e,t,a){"use strict";a.r(t);var i=a(28),r=Object(i.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("Network Replication, Using ReplicatedUsing / RepNotify vars - Epic Wiki")]),e._v(" "),a("h1",{attrs:{id:"network-replication-using-replicatedusing-repnotify-vars"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#network-replication-using-replicatedusing-repnotify-vars"}},[e._v("#")]),e._v(" Network Replication, Using ReplicatedUsing / RepNotify vars")]),e._v(" "),a("p",[e._v("From Epic Wiki")]),e._v(" "),a("p",[e._v("Jump to: "),a("a",{attrs:{href:"#mw-head"}},[e._v("navigation")]),e._v(", "),a("a",{attrs:{href:"#p-search"}},[e._v("search")])]),e._v(" "),a("h2",{attrs:{id:"contents"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contents"}},[e._v("#")]),e._v(" Contents")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#Overview"}},[e._v("1 Overview")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Using_Repnotify.2FReplicatedUsing"}},[e._v("2 Using Repnotify/ReplicatedUsing")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Two_Approaches"}},[e._v("3 Two Approaches")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Notation"}},[e._v("4 Notation")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Server_Rep"}},[e._v("5 Server Rep")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Virtual_OnRep"}},[e._v("6 Virtual OnRep")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#.H"}},[e._v("7 .H")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#CPP"}},[e._v("8 CPP")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Conditional_Replication"}},[e._v("9 Conditional Replication")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Summary"}},[e._v("10 Summary")])]),e._v(" "),a("li",[a("a",{attrs:{href:"#Recommending_Reading"}},[e._v("11 Recommending Reading")])])]),e._v(" "),a("h2",{attrs:{id:"overview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),a("p",[a("em",[e._v("Author:")]),e._v(" "),a("a",{attrs:{href:"/index.php?title=User:Rama",title:"User:Rama"}},[e._v("Rama")]),e._v(" ("),a("a",{attrs:{href:"/index.php?title=User_talk:Rama",title:"User talk:Rama"}},[e._v("talk")]),e._v(")")]),e._v(" "),a("p",[e._v("Dear Community,")]),e._v(" "),a("p",[e._v("Someone asked for some tips on doing network replication in UE4, so I wrote up this tutorial really quick!")]),e._v(" "),a("p",[e._v("The net code structure I am showing here has worked great for me in real multiplayer games with up to 3 people involved who are all simultaneously using my multiplayer in-game editor to co-create the world together! In a packaged game!")]),e._v(" "),a("h2",{attrs:{id:"using-repnotify-replicatedusing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-repnotify-replicatedusing"}},[e._v("#")]),e._v(" Using Repnotify/ReplicatedUsing")]),e._v(" "),a("p",[e._v("Here are two examples from my own code base of how I replicate things that dont have built in replication support like CharacterMovement->Velocity does.")]),e._v(" "),a("p",[e._v("These are things you have to use repnotify for so that every client will do the action that has to be performed locally.")]),e._v(" "),a("p",[e._v("These two examples involve gravity, which you have to set locally.")]),e._v(" "),a("p",[e._v("This is all occurring a class that extends ACharacter")]),e._v(" "),a("h2",{attrs:{id:"two-approaches"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#two-approaches"}},[e._v("#")]),e._v(" Two Approaches")]),e._v(" "),a("p",[e._v("I use two different approaches in the code below.")]),e._v(" "),a("p",[e._v("In one case I rely on the value itself to always be dirtied and updated properly, a bit risky sometimes, depending on your situation.")]),e._v(" "),a("p",[e._v("In the other case I am flipping a bool that serves to guarantee replication will occur, and sending along the actual relevant data at the same time.")]),e._v(" "),a("p",[e._v("I'd recommend you try this latter approach first!")]),e._v(" "),a("h2",{attrs:{id:"notation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#notation"}},[e._v("#")]),e._v(" Notation")]),e._v(" "),a("p",[e._v("Of the various notations that I use in function definitions, the only required ones are _Validate and _Implementation in the CPP file.")]),e._v(" "),a("p",[e._v("I use R_ to tell myself that a variable is being replicated so I can clearly see why it appears in certain places in my .cpp files.")]),e._v(" "),a("h2",{attrs:{id:"server-rep"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server-rep"}},[e._v("#")]),e._v(" Server Rep")]),e._v(" "),a("p",[e._v("The server has to call the OnRep function manually because it does not participate in replication updates since it is the one sending them.")]),e._v(" "),a("p",[e._v("To simplify my code base I just have the Server run the same code the clients are running as it's vars have already been updated.")]),e._v(" "),a("p",[e._v("You'd want to avoid running certain code on a dedicated server that is purely graphical in nature.")]),e._v(" "),a("p",[e._v("You can avoid running code on dedicated server by wrapping it with")]),e._v(" "),a("p",[a("syntaxhighlight",{attrs:{lang:"cpp"}},[e._v(" if(GEngine->GetNetMode(GetWorld())Â != NM_DedicatedServer) {")])],1),e._v(" "),a("p",[e._v("//code to run on non-dedicated servers")]),e._v(" "),a("p",[e._v("} ")]),e._v(" "),a("h2",{attrs:{id:"virtual-onrep"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-onrep"}},[e._v("#")]),e._v(" Virtual OnRep")]),e._v(" "),a("p",[e._v("I always make OnRep functions virtual so that I can override just the OnRep part in subclasses, gaining full use of the replication structure I set up in the base class without having to re-write any of it in subclasses")]),e._v(" "),a("h2",{attrs:{id:"h"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#h"}},[e._v("#")]),e._v(" .H")]),e._v(" "),a("p",[a("syntaxhighlight",{attrs:{lang:"cpp"}},[e._v(" //~~~ Physics Gravity ~~~ UFUNCTION(reliable, server, WithValidation) void SERVER_SetPhysicsGravityActive(bool MakeActive);")])],1),e._v(" "),a("p",[e._v("UPROPERTY(ReplicatedUsing=OnRep_SetPhysicsGravity) bool R_PhysicsGravityActive;")]),e._v(" "),a("p",[e._v("UFUNCTION() virtual void OnRep_SetPhysicsGravity();")]),e._v(" "),a("p",[e._v("//~~~ Gravity Scale ~~~")]),e._v(" "),a("p",[e._v("UFUNCTION(reliable, server, WithValidation) void SERVER_SetGravityScale(float TheGravityScale);")]),e._v(" "),a("p",[e._v("UPROPERTY(ReplicatedUsing=OnRep_SetGravityScale) bool DoRep_GravityScale;")]),e._v(" "),a("p",[e._v("UPROPERTY(Replicated) float R_GravityScale;")]),e._v(" "),a("p",[e._v("UFUNCTION() virtual void OnRep_SetGravityScale(); ")]),e._v(" "),a("h2",{attrs:{id:"cpp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cpp"}},[e._v("#")]),e._v(" CPP")]),e._v(" "),a("p",[a("syntaxhighlight",{attrs:{lang:"cpp"}},[e._v(" //~~~ Physics Gravity ~~~ bool AJoyCharacterBase::SERVER_SetPhysicsGravityActive_Validate(bool MakeActive) { return true; } void AJoyCharacterBase::SERVER_SetPhysicsGravityActive_Implementation(bool MakeActive) { //Rep R_PhysicsGravityActive = MakeActive; OnRep_SetPhysicsGravity(); }")])],1),e._v(" "),a("p",[e._v("void AJoyCharacterBase::OnRep_SetPhysicsGravity() { if(Mesh) { Mesh->SetEnableGravity(R_PhysicsGravityActive); } }")]),e._v(" "),a("p",[e._v("//~~~ Gravity Scale ~~~ bool AJoyCharacterBase::SERVER_SetGravityScale_Validate(float TheGravityScale) { return true; } void AJoyCharacterBase::SERVER_SetGravityScale_Implementation(float TheGravityScale) { //Rep DoRep_GravityScale =Â !DoRep_GravityScale; R_GravityScale = TheGravityScale;")]),e._v(" "),a("p",[e._v("//Server OnRep_SetGravityScale(); }")]),e._v(" "),a("p",[e._v("void AJoyCharacterBase::OnRep_SetGravityScale() { if(!UVictoryCore::VIsValid(CharacterMovement)) return; //~~~~~~~~~~~~~~~~~~~~~~~~~~~~")]),e._v(" "),a("p",[e._v("CharacterMovement->GravityScale = R_GravityScale; CharacterMovement->Velocity = FVector::ZeroVector; }")]),e._v(" "),a("p",[e._v("//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ // Replication List void AJoyCharacterBase::GetLifetimeReplicatedProps( TArray< FLifetimeProperty > & OutLifetimeProps ) const { Super::GetLifetimeReplicatedProps( OutLifetimeProps );")]),e._v(" "),a("p",[e._v("//Physics Gravity DOREPLIFETIME(AJoyCharacterBase, R_PhysicsGravityActive);")]),e._v(" "),a("p",[e._v("//Gravity Scale, Adjustments in In-Game Editor DOREPLIFETIME(AJoyCharacterBase, R_GravityScale); DOREPLIFETIME(AJoyCharacterBase, DoRep_GravityScale); } ")]),e._v(" "),a("h2",{attrs:{id:"conditional-replication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conditional-replication"}},[e._v("#")]),e._v(" Conditional Replication")]),e._v(" "),a("p",[e._v("There are several optional conditions you can place on whether a repnotify will occur!")]),e._v(" "),a("p",[e._v("See "),a("strong",[e._v("CoreNet.h")]),e._v(" for more infoÂ ðŸ˜ƒ")]),e._v(" "),a("p",[a("syntaxhighlight",{attrs:{lang:"cpp"}},[e._v(" DOREPLIFETIME_CONDITION( AShooterWeapon_Instant, HitNotify, COND_SkipOwner ); ")])],1),e._v(" "),a("p",[e._v("Use the above macro instead of the standard DOREPLIFETIME if you wish to use the conditions below!")]),e._v(" "),a("p",[a("syntaxhighlight",{attrs:{lang:"cpp"}},[e._v(" /** Secondary condition to check before considering the replication of a lifetime property. */ enum ELifetimeCondition { COND_None = 0, // This property has no condition, and will send anytime it changes COND_InitialOnly = 1, // This property will only attempt to send on the initial bunch COND_OwnerOnly = 2, // This property will only send to the actor's owner COND_SkipOwner = 3, // This property send to every connection EXCEPT the owner COND_SimulatedOnly = 4, // This property will only send to simulated actors COND_AutonomousOnly = 5, // This property will only send to autonomous actors COND_SimulatedOrPhysics = 6, // This property will send to simulated OR bRepPhysics actors COND_InitialOrOwner = 7, // This property will send on the initial packet, or to the actors owner COND_Custom = 8, // This property has no particular condition, but wants the ability to toggle on/off via SetCustomIsActiveOverride COND_Max = 9, }; ")])],1),e._v(" "),a("h2",{attrs:{id:"summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[e._v("#")]),e._v(" Summary")]),e._v(" "),a("p",[e._v("Here I've demonstrated two ways to use ReplicatedUsing / Repnotify variables, and how you can use them to replicate effects and changes to the game state that are not already replicated for you by UE4!")]),e._v(" "),a("p",[e._v("Enjoy!")]),e._v(" "),a("p",[a("a",{attrs:{href:"/index.php?title=User:Rama",title:"User:Rama"}},[e._v("Rama")]),e._v(" ("),a("a",{attrs:{href:"/index.php?title=User_talk:Rama",title:"User talk:Rama"}},[e._v("talk")]),e._v(")")]),e._v(" "),a("h2",{attrs:{id:"recommending-reading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#recommending-reading"}},[e._v("#")]),e._v(" Recommending Reading")]),e._v(" "),a("p",[a("strong",[e._v("Epic Networking Tips and Tricks")])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.unrealengine.com/blog/network-tips-and-tricks",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.unrealengine.com/blog/network-tips-and-tricks"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("I recommend checking out Zoid's wiki on replication!")]),e._v(" "),a("p",[e._v("He goes over all the basics and terminology for you!")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://wiki.unrealengine.com/Replication",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://wiki.unrealengine.com/Replication"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v('Retrieved from "'),a("a",{attrs:{href:"https://wiki.unrealengine.com/index.php?title=Network_Replication,_Using_ReplicatedUsing_/_RepNotify_vars&oldid=207",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://wiki.unrealengine.com/index.php?title=Network_Replication,_Using_ReplicatedUsing_/_RepNotify_vars&oldid=207"),a("OutboundLink")],1),e._v('"')]),e._v(" "),a("p",[a("a",{attrs:{href:"/index.php?title=Special:Categories",title:"Special:Categories"}},[e._v("Category")]),e._v(":")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"/index.php?title=Category:Code",title:"Category:Code"}},[e._v("Code")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);