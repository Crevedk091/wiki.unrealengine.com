<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wiki.unrealengine.com</title>
    <meta name="description" content="A static site pulled from the internet archive">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css" as="style"><link rel="preload" href="/wiki.unrealengine.com/assets/js/app.aaf63946.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/2.4f53495e.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/875.0684ce10.js" as="script">
    <link rel="stylesheet" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki.unrealengine.com/" class="home-link router-link-active"><!----> <span class="site-name">wiki.unrealengine.com</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Network Replication, Using ReplicatedUsing / RepNotify vars - Epic Wiki</p> <h1 id="network-replication-using-replicatedusing-repnotify-vars"><a href="#network-replication-using-replicatedusing-repnotify-vars" class="header-anchor">#</a> Network Replication, Using ReplicatedUsing / RepNotify vars</h1> <p>From Epic Wiki</p> <p>Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a></p> <h2 id="contents"><a href="#contents" class="header-anchor">#</a> Contents</h2> <ul><li><a href="#Overview">1 Overview</a></li> <li><a href="#Using_Repnotify.2FReplicatedUsing">2 Using Repnotify/ReplicatedUsing</a></li> <li><a href="#Two_Approaches">3 Two Approaches</a></li> <li><a href="#Notation">4 Notation</a></li> <li><a href="#Server_Rep">5 Server Rep</a></li> <li><a href="#Virtual_OnRep">6 Virtual OnRep</a></li> <li><a href="#.H">7 .H</a></li> <li><a href="#CPP">8 CPP</a></li> <li><a href="#Conditional_Replication">9 Conditional Replication</a></li> <li><a href="#Summary">10 Summary</a></li> <li><a href="#Recommending_Reading">11 Recommending Reading</a></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p><em>Author:</em> <a href="/index.php?title=User:Rama" title="User:Rama">Rama</a> (<a href="/index.php?title=User_talk:Rama" title="User talk:Rama">talk</a>)</p> <p>Dear Community,</p> <p>Someone asked for some tips on doing network replication in UE4, so I wrote up this tutorial really quick!</p> <p>The net code structure I am showing here has worked great for me in real multiplayer games with up to 3 people involved who are all simultaneously using my multiplayer in-game editor to co-create the world together! In a packaged game!</p> <h2 id="using-repnotify-replicatedusing"><a href="#using-repnotify-replicatedusing" class="header-anchor">#</a> Using Repnotify/ReplicatedUsing</h2> <p>Here are two examples from my own code base of how I replicate things that dont have built in replication support like CharacterMovement-&gt;Velocity does.</p> <p>These are things you have to use repnotify for so that every client will do the action that has to be performed locally.</p> <p>These two examples involve gravity, which you have to set locally.</p> <p>This is all occurring a class that extends ACharacter</p> <h2 id="two-approaches"><a href="#two-approaches" class="header-anchor">#</a> Two Approaches</h2> <p>I use two different approaches in the code below.</p> <p>In one case I rely on the value itself to always be dirtied and updated properly, a bit risky sometimes, depending on your situation.</p> <p>In the other case I am flipping a bool that serves to guarantee replication will occur, and sending along the actual relevant data at the same time.</p> <p>I'd recommend you try this latter approach first!</p> <h2 id="notation"><a href="#notation" class="header-anchor">#</a> Notation</h2> <p>Of the various notations that I use in function definitions, the only required ones are _Validate and _Implementation in the CPP file.</p> <p>I use R_ to tell myself that a variable is being replicated so I can clearly see why it appears in certain places in my .cpp files.</p> <h2 id="server-rep"><a href="#server-rep" class="header-anchor">#</a> Server Rep</h2> <p>The server has to call the OnRep function manually because it does not participate in replication updates since it is the one sending them.</p> <p>To simplify my code base I just have the Server run the same code the clients are running as it's vars have already been updated.</p> <p>You'd want to avoid running certain code on a dedicated server that is purely graphical in nature.</p> <p>You can avoid running code on dedicated server by wrapping it with</p> <p><syntaxhighlight lang="cpp"> if(GEngine-&gt;GetNetMode(GetWorld())Â != NM_DedicatedServer) {</syntaxhighlight></p> <p>//code to run on non-dedicated servers</p> <p>} </p> <h2 id="virtual-onrep"><a href="#virtual-onrep" class="header-anchor">#</a> Virtual OnRep</h2> <p>I always make OnRep functions virtual so that I can override just the OnRep part in subclasses, gaining full use of the replication structure I set up in the base class without having to re-write any of it in subclasses</p> <h2 id="h"><a href="#h" class="header-anchor">#</a> .H</h2> <p><syntaxhighlight lang="cpp"> //~~~ Physics Gravity ~~~ UFUNCTION(reliable, server, WithValidation) void SERVER_SetPhysicsGravityActive(bool MakeActive);</syntaxhighlight></p> <p>UPROPERTY(ReplicatedUsing=OnRep_SetPhysicsGravity) bool R_PhysicsGravityActive;</p> <p>UFUNCTION() virtual void OnRep_SetPhysicsGravity();</p> <p>//~~~ Gravity Scale ~~~</p> <p>UFUNCTION(reliable, server, WithValidation) void SERVER_SetGravityScale(float TheGravityScale);</p> <p>UPROPERTY(ReplicatedUsing=OnRep_SetGravityScale) bool DoRep_GravityScale;</p> <p>UPROPERTY(Replicated) float R_GravityScale;</p> <p>UFUNCTION() virtual void OnRep_SetGravityScale(); </p> <h2 id="cpp"><a href="#cpp" class="header-anchor">#</a> CPP</h2> <p><syntaxhighlight lang="cpp"> //~~~ Physics Gravity ~~~ bool AJoyCharacterBase::SERVER_SetPhysicsGravityActive_Validate(bool MakeActive) { return true; } void AJoyCharacterBase::SERVER_SetPhysicsGravityActive_Implementation(bool MakeActive) { //Rep R_PhysicsGravityActive = MakeActive; OnRep_SetPhysicsGravity(); }</syntaxhighlight></p> <p>void AJoyCharacterBase::OnRep_SetPhysicsGravity() { if(Mesh) { Mesh-&gt;SetEnableGravity(R_PhysicsGravityActive); } }</p> <p>//~~~ Gravity Scale ~~~ bool AJoyCharacterBase::SERVER_SetGravityScale_Validate(float TheGravityScale) { return true; } void AJoyCharacterBase::SERVER_SetGravityScale_Implementation(float TheGravityScale) { //Rep DoRep_GravityScale =Â !DoRep_GravityScale; R_GravityScale = TheGravityScale;</p> <p>//Server OnRep_SetGravityScale(); }</p> <p>void AJoyCharacterBase::OnRep_SetGravityScale() { if(!UVictoryCore::VIsValid(CharacterMovement)) return; //~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p> <p>CharacterMovement-&gt;GravityScale = R_GravityScale; CharacterMovement-&gt;Velocity = FVector::ZeroVector; }</p> <p>//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ // Replication List void AJoyCharacterBase::GetLifetimeReplicatedProps( TArray&lt; FLifetimeProperty &gt; &amp; OutLifetimeProps ) const { Super::GetLifetimeReplicatedProps( OutLifetimeProps );</p> <p>//Physics Gravity DOREPLIFETIME(AJoyCharacterBase, R_PhysicsGravityActive);</p> <p>//Gravity Scale, Adjustments in In-Game Editor DOREPLIFETIME(AJoyCharacterBase, R_GravityScale); DOREPLIFETIME(AJoyCharacterBase, DoRep_GravityScale); } </p> <h2 id="conditional-replication"><a href="#conditional-replication" class="header-anchor">#</a> Conditional Replication</h2> <p>There are several optional conditions you can place on whether a repnotify will occur!</p> <p>See <strong>CoreNet.h</strong> for more infoÂ ðŸ˜ƒ</p> <p><syntaxhighlight lang="cpp"> DOREPLIFETIME_CONDITION( AShooterWeapon_Instant, HitNotify, COND_SkipOwner ); </syntaxhighlight></p> <p>Use the above macro instead of the standard DOREPLIFETIME if you wish to use the conditions below!</p> <p><syntaxhighlight lang="cpp"> /** Secondary condition to check before considering the replication of a lifetime property. */ enum ELifetimeCondition { COND_None = 0, // This property has no condition, and will send anytime it changes COND_InitialOnly = 1, // This property will only attempt to send on the initial bunch COND_OwnerOnly = 2, // This property will only send to the actor's owner COND_SkipOwner = 3, // This property send to every connection EXCEPT the owner COND_SimulatedOnly = 4, // This property will only send to simulated actors COND_AutonomousOnly = 5, // This property will only send to autonomous actors COND_SimulatedOrPhysics = 6, // This property will send to simulated OR bRepPhysics actors COND_InitialOrOwner = 7, // This property will send on the initial packet, or to the actors owner COND_Custom = 8, // This property has no particular condition, but wants the ability to toggle on/off via SetCustomIsActiveOverride COND_Max = 9, }; </syntaxhighlight></p> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <p>Here I've demonstrated two ways to use ReplicatedUsing / Repnotify variables, and how you can use them to replicate effects and changes to the game state that are not already replicated for you by UE4!</p> <p>Enjoy!</p> <p><a href="/index.php?title=User:Rama" title="User:Rama">Rama</a> (<a href="/index.php?title=User_talk:Rama" title="User talk:Rama">talk</a>)</p> <h2 id="recommending-reading"><a href="#recommending-reading" class="header-anchor">#</a> Recommending Reading</h2> <p><strong>Epic Networking Tips and Tricks</strong></p> <p><a href="https://www.unrealengine.com/blog/network-tips-and-tricks" target="_blank" rel="noopener noreferrer">https://www.unrealengine.com/blog/network-tips-and-tricks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>I recommend checking out Zoid's wiki on replication!</p> <p>He goes over all the basics and terminology for you!</p> <p><a href="https://wiki.unrealengine.com/Replication" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/Replication<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Retrieved from &quot;<a href="https://wiki.unrealengine.com/index.php?title=Network_Replication,_Using_ReplicatedUsing_/_RepNotify_vars&amp;oldid=207" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/index.php?title=Network_Replication,_Using_ReplicatedUsing_/_RepNotify_vars&amp;oldid=207<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;</p> <p><a href="/index.php?title=Special:Categories" title="Special:Categories">Category</a>:</p> <ul><li><a href="/index.php?title=Category:Code" title="Category:Code">Code</a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wiki.unrealengine.com/assets/js/app.aaf63946.js" defer></script><script src="/wiki.unrealengine.com/assets/js/2.4f53495e.js" defer></script><script src="/wiki.unrealengine.com/assets/js/875.0684ce10.js" defer></script>
  </body>
</html>
