<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wiki.unrealengine.com</title>
    <meta name="description" content="A static site pulled from the internet archive">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css" as="style"><link rel="preload" href="/wiki.unrealengine.com/assets/js/app.aaf63946.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/2.4f53495e.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/901.53a757f0.js" as="script">
    <link rel="stylesheet" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki.unrealengine.com/" class="home-link router-link-active"><!----> <span class="site-name">wiki.unrealengine.com</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>PhysX, Integrating PhysX Code into Your Project - Epic Wiki</p> <h1 id="physx-integrating-physx-code-into-your-project"><a href="#physx-integrating-physx-code-into-your-project" class="header-anchor">#</a> PhysX, Integrating PhysX Code into Your Project</h1> <p>From Epic Wiki</p> <p>Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a></p> <h2 id="contents"><a href="#contents" class="header-anchor">#</a> Contents</h2> <ul><li><a href="#Overview">1 Overview</a></li> <li><a href="#PhysX_3.3_Source_Code_For_UE4_Developers">2 PhysX 3.3 Source Code For UE4 Developers</a></li> <li><a href="#Compiling_the_PhysX_Source_Code">3 Compiling the PhysX Source Code</a></li> <li><a href="#Video_of_a_PhysX_Vortex_Spiral_in_UE4">4 Video of a PhysX Vortex Spiral in UE4</a></li> <li><a href="#Pics">5 Pics</a></li> <li><a href="#Custom_Destructible_Mesh_Class">6 Custom Destructible Mesh Class</a> <ul><li><a href="#HappyDestructible.h">6.1 HappyDestructible.h</a></li> <li><a href="#HappyDestructible.cpp">6.2 HappyDestructible.cpp</a></li></ul></li> <li><a href="#Packaging">7 Packaging</a></li> <li><a href="#PhysX_.7E_Basic">8 PhysX ~ Basic</a> <ul><li><a href="#Build.CS">8.1 Build.CS</a></li> <li><a href="#The_Essential_Include">8.2 The Essential Include</a></li></ul></li> <li><a href="#PhysX_.7E_Advanced">9 PhysX ~ Advanced</a> <ul><li><a href="#PhysicsPublic.h">9.1 PhysicsPublic.h</a></li> <li><a href="#PhysXSupport.h_for_Scene_Read.2FWrite_Locking">9.2 PhysXSupport.h for Scene Read/Write Locking</a></li></ul></li> <li><a href="#PhysX_.7E_How_to_Get_the_PhysX_Scene_.26_WRITE.2FREAD_LOCK">10 PhysX ~ How to Get the PhysX Scene &amp; WRITE/READ LOCK</a></li> <li><a href="#UE4_4.15.2B_Entry_PhysX_Points_Into_UE4_Engine">11 UE4 4.15+ Entry PhysX Points Into UE4 Engine</a></li> <li><a href="#Conclusion">12 Conclusion</a></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p><em>Author:</em> <a href="/index.php?title=User:Rama" title="User:Rama">Rama</a> (<a href="/index.php?title=User_talk:Rama" title="User talk:Rama">talk</a>)</p> <p>In this tutorial I am showing you how you can work with Nvidia PhysX directly in your UE4 code base!</p> <p>I provide sample code that iterates over all the destructible chunks of a DestructibleComponent and draws their current world space positions to the screen!</p> <h2 id="physx-3-3-source-code-for-ue4-developers"><a href="#physx-3-3-source-code-for-ue4-developers" class="header-anchor">#</a> PhysX 3.3 Source Code For UE4 Developers</h2> <p>Nvidia has made PhysX3.3 Open Source for all Unreal Engine 4 Developers!</p> <p>Here's the link to the PhysX 3.3 Source Code</p> <p><a href="https://github.com/EpicGames/UnrealEngine/tree/master/Engine/Source/ThirdParty/PhysX/PhysX-3.3/Source" target="_blank" rel="noopener noreferrer">PhysX3.3 Source Code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>edit:</strong> the link is broken but PhysX source code is in the UnrealEngine repo under .../Source/ThirdParty/PhysX/</p> <p>You must be signed in to a <strong>UE4-Linked Github account</strong> to view the above link!</p> <p>Simply sign up for Unreal Engine 4 and then follow the steps to link your github account to UE4.</p> <p><a href="https://www.unrealengine.com/ue4-on-github" target="_blank" rel="noopener noreferrer">UE4 Gitub Setup<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="compiling-the-physx-source-code"><a href="#compiling-the-physx-source-code" class="header-anchor">#</a> Compiling the PhysX Source Code</h2> <p>Here's how to compile PhysX source code for UE4 as of 4.8!</p> <p><a href="https://wiki.unrealengine.com/PhysX_Source_Guide" target="_blank" rel="noopener noreferrer">Compiling PhysX Source Code for UE4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="video-of-a-physx-vortex-spiral-in-ue4"><a href="#video-of-a-physx-vortex-spiral-in-ue4" class="header-anchor">#</a> Video of a PhysX Vortex Spiral in UE4</h2> <p>In this video I am programmatically arranging apex pieces after the mesh is destroyed and the pieces bounce around normally.</p> <p>I am arranging the pieces into a spiral/vortex formation!</p> <p>Please notice that the apex pieces continue to have collision with the world and even each other, after I begin spinning them myself via C++!</p> <p>This is all done via PhysX coding!</p> <p>There is <strong>no measurable performance</strong> hit with my current method, my frame rate stays solid at maxÂ ðŸ˜ƒ</p> <p>In other words, I literally cannot detect any drop in performance even after I start the PhysX coding that you see in video below!</p> <p><youtube><a href="https://www.youtube.com/watch?v=7KpkQPhvBKA" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=7KpkQPhvBKA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></youtube></p> <p>This video is from my Abatron work in progress thread, <a href="https://forums.unrealengine.com/showthread.php?45059-Abatron-the-making-of-a-UE4-Hybrid-game-" target="_blank" rel="noopener noreferrer">UE4 Forum Link: Abatron<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&amp;p=176126#post176126)</p> <h2 id="pics"><a href="#pics" class="header-anchor">#</a> Pics</h2> <p>Below you can see I am drawing to screen the world space positions of each chunk of a Destructible Mesh using the PhysX code!</p> <p>Some of the points can't be seen cause they are hidden inside the little piecesÂ ðŸ˜ƒ</p> <p>But you can also see I am displaying the locations to the screen! Yay!</p> <p><a href="/index.php?title=File:NvdiaUE4CPP1.jpg"><img src="https://d3ar1piqh1oeli.cloudfront.net/5/56/NvdiaUE4CPP1.jpg/900px-NvdiaUE4CPP1.jpg" alt="NvdiaUE4CPP1.jpg"></a></p> <p>Below I added a vertical offset to make the points visible for all chunks!</p> <p><a href="/index.php?title=File:PhysXUE4CPP2.jpg"><img src="https://d3ar1piqh1oeli.cloudfront.net/0/09/PhysXUE4CPP2.jpg/900px-PhysXUE4CPP2.jpg" alt="PhysXUE4CPP2.jpg"></a></p> <p>Enjoy!</p> <h2 id="custom-destructible-mesh-class"><a href="#custom-destructible-mesh-class" class="header-anchor">#</a> Custom Destructible Mesh Class</h2> <p>Here's a custom destructible mesh class you can use to test whether you got the PhysX code setup properly!</p> <p>This is the code I used for the picture above!</p> <h3 id="happydestructible-h"><a href="#happydestructible-h" class="header-anchor">#</a> HappyDestructible.h</h3> <syntaxhighlight lang="cpp"><ol><li><p>pragma once</p></li> <li><p>include &quot;HappyDestructible.generated.h&quot;</p></li></ol> <p>UCLASS() class AHappyDestructibleÂ : public ADestructibleActor { GENERATED_UCLASS_BODY()</p> <p>protected: virtual void Tick(float DeltaTime) override;</p> <p>//Drawing! public: FORCEINLINE void DrawPoint ( const FVector&amp; Loc, const float&amp; Size = 7, const FColor&amp; Color = FColor::Red, const float Duration=-1.f ) const { DrawDebugPoint( GetWorld(), Loc, Size, //thickness Color, false, Duration ); }</p> <p>FORCEINLINE void ScreenMsg(const FString&amp; Msg) { GEngine-&gt;AddOnScreenDebugMessage(-1, 5.f, FColor::Red, *Msg); }</p> <p>FORCEINLINE void ScreenMsg(const FString&amp; Msg, const FString&amp; Msg2) { GEngine-&gt;AddOnScreenDebugMessage(-1, 5.f, FColor::Red, FString::Printf(TEXT(&quot;%sÂ %s&quot;), *Msg, *Msg2)); }</p> <p>}; </p></syntaxhighlight><p></p> <h3 id="happydestructible-cpp"><a href="#happydestructible-cpp" class="header-anchor">#</a> HappyDestructible.cpp</h3> <syntaxhighlight lang="cpp"><ol><li>include &quot;YourGame.h&quot;</li> <li>include &quot;HappyDestructible.h&quot;</li></ol> <p>//~~~~~~~~~~~~~~~~~~~~~~~~ // PhysX</p> <ol><li>include &quot;PhysXIncludes.h&quot;</li></ol> <p>//~~~~~~~~~~~~~~~~~~~~~~~~</p> <p>AHappyDestructible::AHappyDestructible(const class FPostConstructInitializeProperties&amp; PCIP)Â : Super(PCIP) {</p> <p>}</p> <p>//Tick void AHappyDestructible::Tick(float DeltaTime) { Super::Tick(DeltaTime); //~~~~~~~~~~~~</p> <p>//Draw All Centers to the screen! #if WITH_PHYSX ScreenMsg(&quot;Got into PhysX!!!&quot;);</p> <div class="language- extra-class"><pre><code>   //4.8 Version
</code></pre></div><p>uint32 ChunkCount = DestructibleComponent-&gt;ApexDestructibleActor-&gt;getNumVisibleChunks(); const uint16* ChunkIndices = DestructibleComponent-&gt;ApexDestructibleActor-&gt;getVisibleChunks(); for(uint32 c = 0; c &lt; ChunkCount; c++) { PxRigidDynamic* PActor = DestructibleComponent-&gt;ApexDestructibleActor-&gt;getChunkPhysXActor(ChunkIndices[c]); check(PActor); PxTransform Trans = PActor-&gt;getGlobalPose(); PxVec3&amp; PxLoc = Trans.p;</p> <p>FVector Location(PxLoc.x,PxLoc.y,PxLoc.z);</p> <p>DrawPoint(Location);</p> <p>ScreenMsg(&quot;physx loc&quot;, Location.ToString()); }</p> <div class="language- extra-class"><pre><code>   /\* PRE 4.8 Version
</code></pre></div><p>for(FDestructibleChunkInfo&amp; EachÂ : DestructibleComponent-&gt;ChunkInfos) { physx::PxRigidDynamic* Actor = Each.Actor;</p> <p>if(Actor) { PxTransform Trans = Actor-&gt;getGlobalPose(); PxVec3&amp; PxLoc = Trans.p;</p> <p>FVector Location(PxLoc.x,PxLoc.y,PxLoc.z);</p> <p>DrawPoint(Location);</p> <p>ScreenMsg(&quot;physx loc&quot;, Location.ToString()); } }</p> <div class="language- extra-class"><pre><code>   \*/
#endif // WITH\_PHYSX 
</code></pre></div><p>} </p></syntaxhighlight><p></p> <h2 id="packaging"><a href="#packaging" class="header-anchor">#</a> Packaging</h2> <p>I can verify that the code I've shared packages just fine into a full release game!</p> <h2 id="physx-basic"><a href="#physx-basic" class="header-anchor">#</a> PhysX ~ Basic</h2> <h3 id="build-cs"><a href="#build-cs" class="header-anchor">#</a> Build.CS</h3> <p>You will need the following to work with Nvidia Apex:</p> <p><syntaxhighlight lang="cpp"> PublicDependencyModuleNames.AddRange(new string[] { &quot;Core&quot;, &quot;CoreUObject&quot;, &quot;Engine&quot;, &quot;InputCore&quot;,</syntaxhighlight></p> <p>&quot;PhysX&quot;, &quot;APEX&quot; //PhysX</p> <p>}); </p> <h3 id="the-essential-include"><a href="#the-essential-include" class="header-anchor">#</a> The Essential Include</h3> <p>You can include this in your .cpp or .h if you define any Px vars in your .h files.</p> <p><syntaxhighlight lang="cpp"> //PhysX</syntaxhighlight></p> <ol><li>include &quot;PhysXIncludes.h&quot;</li></ol> <h2 id="physx-advanced"><a href="#physx-advanced" class="header-anchor">#</a> PhysX ~ Advanced</h2> <h3 id="physicspublic-h"><a href="#physicspublic-h" class="header-anchor">#</a> PhysicsPublic.h</h3> <syntaxhighlight lang="cpp"><ol><li>include &quot;PhysicsPublic.h&quot; //FPhysScene</li> <li>include &quot;PhysXPublic.h&quot; //PtoU conversions</li></ol></syntaxhighlight> <p>These include give you access to the conversion functions from PhysX to Unreal and back for various essential types like FVector / PxVec3</p> <h3 id="physxsupport-h-for-scene-read-write-locking"><a href="#physxsupport-h-for-scene-read-write-locking" class="header-anchor">#</a> PhysXSupport.h for Scene Read/Write Locking</h3> <p><syntaxhighlight lang="cpp"> //For Scene Locking using Epic's awesome helper macros like SCOPED_SCENE_READ_LOCK</syntaxhighlight></p> <ol><li>include &quot;Runtime/Engine/Private/PhysicsEngine/PhysXSupport.h&quot;</li></ol> <p>This include is absolutely essential if you want to do any <strong>low-level multi-threaded PhysX coding</strong>!</p> <p>Epic has created some wonderful macros to make it fast to create scoped read/write locks of the PhysX scene, for example see below!</p> <h2 id="physx-how-to-get-the-physx-scene-write-read-lock"><a href="#physx-how-to-get-the-physx-scene-write-read-lock" class="header-anchor">#</a> PhysX ~ How to Get the PhysX Scene &amp; WRITE/READ LOCK</h2> <p>Here's some sample code I'v written for how you can get the PhysX scene if you have the UE4 UWorld*Â !</p> <p><syntaxhighlight lang="cpp"> void SomeClass::SomeFunction(UWorld* World) {</syntaxhighlight></p> <p>check(World);
//if crash here world was not valid, needs to be investigated, did it come from a UObject?</p> <p>FPhysScene* PhysScene = World-&gt;GetPhysicsScene();
if(!PhysScene) return;</p> <p>// Scene Lock for Multi-Threading
PxScene* SyncScene = PhysScene-&gt;GetPhysXScene(PST_Sync);
SCOPED_SCENE_WRITE_LOCK(SyncScene); //or SCOPED_SCENE_READ_LOCK if you only need to read</p> <p>//now you can use the PhysX scene in multi-threaded fashion within this function context!
//  -Rama</p> <p>} </p> <p>Yay!</p> <h2 id="ue4-4-15-entry-physx-points-into-ue4-engine"><a href="#ue4-4-15-entry-physx-points-into-ue4-engine" class="header-anchor">#</a> UE4 4.15+ Entry PhysX Points Into UE4 Engine</h2> <p>As of 4.15 there are new entry points you can use to write a physX-related plugin or game project and interact with UE4's integration of PhysX!</p> <p>&quot;We have now refactored our PhysX Vehicle support as an optional plugin! This makes it easy for games that are not using vehicles to exclude this feature and save disk space and memory. This work also adds several useful physics extension points to Engine (e.g. <strong>OnPhysSceneInit</strong>/Term, <strong>OnPhysSceneStep</strong>) to make it easier for other developers to write their own similar systems.&quot;</p> <p><a href="https://www.unrealengine.com/blog/unreal-engine-4-15-released" target="_blank" rel="noopener noreferrer">https://www.unrealengine.com/blog/unreal-engine-4-15-released<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>Using the same UE4 class code, the build cs additions, and #includes I've shown above, you can now write any PhysX code you want!</p> <p>Using the PhysX Scene access code I've shown above, you can do lowest level multi-threaded PhysX coding!</p> <p>Have fun!</p> <p><a href="/index.php?title=User:Rama" title="User:Rama">Rama</a> (<a href="/index.php?title=User_talk:Rama" title="User talk:Rama">talk</a>)</p> <p>Retrieved from &quot;<a href="https://wiki.unrealengine.com/index.php?title=PhysX,_Integrating_PhysX_Code_into_Your_Project&amp;oldid=337" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/index.php?title=PhysX,_Integrating_PhysX_Code_into_Your_Project&amp;oldid=337<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;</p> <p><a href="/index.php?title=Special:Categories" title="Special:Categories">Category</a>:</p> <ul><li><a href="/index.php?title=Category:Code" title="Category:Code">Code</a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wiki.unrealengine.com/assets/js/app.aaf63946.js" defer></script><script src="/wiki.unrealengine.com/assets/js/2.4f53495e.js" defer></script><script src="/wiki.unrealengine.com/assets/js/901.53a757f0.js" defer></script>
  </body>
</html>
