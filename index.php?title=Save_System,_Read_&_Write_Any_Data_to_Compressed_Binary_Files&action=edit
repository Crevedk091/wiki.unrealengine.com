<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<meta charset="UTF-8" /><title>View source for Save System, Read &amp; Write Any Data to Compressed Binary Files - Epic Wiki</title>
<meta name="generator" content="MediaWiki 1.22.2" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Epic Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://wiki.unrealengine.com/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Epic Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.vector&amp;only=styles&amp;skin=epic&amp;*" />
<link rel="stylesheet" href="/extensions/EpicVideoSystem/CSS/VideoSystem.css" />
<link rel="stylesheet" href="/skins/epic/resources/screen.css?303" media="screen" />
<link rel="stylesheet" href="/skins/epic/resources/epic.css?303" media="screen" />
<link rel="stylesheet" href="/skins/epic/resources/prettify.css?303" media="screen" />
<link rel="stylesheet" href="/skins/epic/resources/jquery.qtip.css?303" media="screen" /><meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=epic&amp;*" />
<style>a:lang(ar),a:lang(ckb),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: my_wiki:resourceloader:filter:minify-css:7:07b6a8ccf3fd62e770f192d0a6f8e123 */</style>

<script src="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=epic&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Save_System,_Read_\u0026_Write_Any_Data_to_Compressed_Binary_Files","wgTitle":"Save System, Read \u0026 Write Any Data to Compressed Binary Files","wgCurRevisionId":22381,"wgRevisionId":0,"wgArticleId":588,"wgIsArticle":false,"wgIsRedirect":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Save_System,_Read_\u0026_Write_Any_Data_to_Compressed_Binary_Files","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"dialogs":true,"hidesig":true,"templateEditor":false,"templates":false,"preview":true,"previewDialog":false,"publish":true,"toc":false}});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"epic","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"vector-simplesearch":1,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,
"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"useeditwarning":1,"prefershttps":1,"usebetatoolbar":1,"usebetatoolbar-cgd":1,"wikieditor-preview":1,"wikieditor-publish":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: my_wiki:resourceloader:filter:minify-js:7:2197af7670c41256853f340e275ede1b */
}</script>
<script src="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=skins.epic.extras.js%7Cskins.epic.fancybox.js%7Cskins.epic.js%7Cskins.epic.qtip.js%7Cskins.epic.slimscroll.js&amp;only=scripts&amp;skin=epic&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/epic/csshover.min.htc")}</style><![endif]--><script type="text/javascript">
var experimentID = false;
var cxApi = null;
var variation = 0;
var fancyTitle = "";
var CE_SNAPSHOT_NAME = document.getElementsByTagName("title")[0].innerHTML;
$(document).ready(function(){
	if(experimentID != false)
	{
		$(head).append('<script src="//www.google-analytics.com/cx/api.js?experiment=' + experimentID + '" />' + '</scr' + 'ipt>');
		HandleExperiment();
	}
	else
	{
		CE_SNAPSHOT_NAME = (fancyTitle != "" ? fancyTitle : document.getElementsByTagName("title")[0].innerHTML);
		setTimeout(function () {
			var a = document.createElement("script");
			var b = document.getElementsByTagName("script")[0];
			a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0028/4572.js?" + Math.floor(new Date().getTime() / 3600000);
			a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b)
		}, 1);	
	}
});
function HandleExperiment()
{
	CE_SNAPSHOT_NAME = (fancyTitle != "" ? fancyTitle : document.getElementsByTagName("title")[0].innerHTML);
	if(cxApi != null)
	{
		variation = cxApi.chooseVariation();
		cxApi.setChosenVariation(variation, experimentID);
		if(variation != cxApi.ORIGINAL_VARIATION && variation != cxApi.NO_CHOSEN_VARIATION && variation != cxApi.NOT_PARTICIPATING)
		{
			//var URL = document.location.href + (document.location.search != '' ? '&var=' : '?var=') + variation;
			ga('send', 'event', 'A/B', 'ID: ' + experimentID, 'Variation: ' + variation, {'nonInteraction': 1});
			//document.location.href = URL; 
			CE_SNAPSHOT_NAME = document.getElementsByTagName("title")[0].innerHTML + ' (variation ' + variation + ')';
			var test = "";
		}
		else
		{
			ga('send', 'event', 'A/B', 'ID: ' + experimentID, 'Variation: ' + variation, {'nonInteraction': 1});
		}
		ToggleExperimentContent(variation);
		setTimeout(function () {
			var a = document.createElement("script");
			var b = document.getElementsByTagName("script")[0];
			a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0028/4572.js?" + Math.floor(new Date().getTime() / 3600000);
			a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b)
		}, 1);
	}
	else
	{
		setTimeout("HandleExperiment()", 500);
	}
}

function ToggleExperimentContent(variation)
{
	$('.AB').hide();
	$('#variation_' + variation).show();
}
</script></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Save_System_Read_Write_Any_Data_to_Compressed_Binary_Files skin-epic action-edit vector-animateLayout">
		<!--<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>-->
		<!-- Google Tag Manager -->
		<noscript>
			<iframe src="//www.googletagmanager.com/ns.html?id=GTM-KWRD6D"
					height="0" width="0" style="display:none;visibility:hidden"></iframe>
		</noscript>
		<script>
		(function (w, d, s, l, i) {
		w[l] = w[l] || []; w[l].push({
		'gtm.start':
		new Date().getTime(), event: 'gtm.js'
		}); var f = d.getElementsByTagName(s)[0],
		j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
		'//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
		})(window, document, 'script', 'dataLayer', 'GTM-KWRD6D');</script>
		<!-- End Google Tag Manager -->
		<div id="webThree">
		<div id="head"></div>
		<div id="pagedefault">		
                    <div id="pagenav">
                        <div>
                            <!-- Start of Other language links -->
                            <!-- End of Other language links -->
                            <div class="homelink_container">
                                <a href="https://wiki.unrealengine.com" title="UE4 Wiki Home" class="homelink">HOME</a>
                            </div>
                        </div>
                        <div style="clear:both;">
                        </div>
                    </div>	
		<div id="mw-navigation" style="max-width:972px;margin:1em auto 0 auto;">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="jumplink" onclick="$('#sidebar').toggle();">
					Navigation
				</div>
				<div id="sidebar">
					<!-- Start of jump page links -->
					<div class="largetitle">
						Quick Links
					</div>
					<div class="arrowlist">
						<!-- End of jump page links -->
						<!-- Start of related page links -->
						<!-- End of related page links -->								
						<div id="mw-panel">
							<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
	<h3 id='p-navigation-label'>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-recentchanges"><a href="/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Community' aria-labelledby='p-Community-label'>
	<h3 id='p-Community-label'>Community</h3>
	<div class="body">
		<ul>
			<li id="n-UE4-Games"><a href="/Category:Games">UE4 Games</a></li>
			<li id="n-Dev-Blogs"><a href="/Developer_Blogs">Dev Blogs</a></li>
			<li id="n-Dev-Livestreams"><a href="/Developer_Livestreams">Dev Livestreams</a></li>
			<li id="n-Code-Sharing-Hub"><a href="/GitHub_Sharing_Hub">Code Sharing Hub</a></li>
			<li id="n-UE-User-Groups"><a href="/User_Group_Map">UE User Groups</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Learning_Resources' aria-labelledby='p-Learning_Resources-label'>
	<h3 id='p-Learning_Resources-label'>Learning Resources</h3>
	<div class="body">
		<ul>
			<li id="n-Tutorials"><a href="/Category:Tutorials">Tutorials</a></li>
			<li id="n-Example-Projects"><a href="/Category:Example_Projects">Example Projects</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Software_and_Tools' aria-labelledby='p-Software_and_Tools-label'>
	<h3 id='p-Software_and_Tools-label'>Software and Tools</h3>
	<div class="body">
		<ul>
			<li id="n-Plug-ins"><a href="/Category:Plug-ins">Plug-ins</a></li>
			<li id="n-Art:-3D"><a href="/3D_Art_Resources">Art: 3D</a></li>
			<li id="n-Art:-2D"><a href="/2D_Art_Resources">Art: 2D</a></li>
			<li id="n-Audio"><a href="/Audio_Resources">Audio</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Modding' aria-labelledby='p-Modding-label'>
	<h3 id='p-Modding-label'>Modding</h3>
	<div class="body">
		<ul>
			<li id="n-Modding-Resources"><a href="/Category:Modding_Resources">Modding Resources</a></li>
			<li id="n-Moddable-Games"><a href="/Category:Moddable_Games">Moddable Games</a></li>
			<li id="n-Unreal-Tournament"><a href="/Category:Unreal_Tournament">Unreal Tournament</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-Epic_Official' aria-labelledby='p-Epic_Official-label'>
	<h3 id='p-Epic_Official-label'>Epic Official</h3>
	<div class="body">
		<ul>
			<li id="n-Website"><a href="https://www.unrealengine.com" rel="nofollow">Website</a></li>
			<li id="n-Learning-Resources"><a href="https://docs.unrealengine.com/latest/INT/" rel="nofollow">Learning Resources</a></li>
			<li id="n-Forums"><a href="https://forums.unrealengine.com/" rel="nofollow">Forums</a></li>
			<li id="n-Blog"><a href="https://www.unrealengine.com/blog" rel="nofollow">Blog</a></li>
			<li id="n-YouTube"><a href="https://www.youtube.com/UnrealEngine" rel="nofollow">YouTube</a></li>
			<li id="n-Twitch"><a href="http://www.twitch.tv/unrealengine" rel="nofollow">Twitch</a></li>
			<li id="n-Twitter"><a href="https://twitter.com/UnrealEngine" rel="nofollow">Twitter</a></li>
			<li id="n-Facebook"><a href="https://www.facebook.com/UnrealEngine" rel="nofollow">Facebook</a></li>
			<li id="n-Instagram"><a href="https://instagram.com/unrealengine/" rel="nofollow">Instagram</a></li>
		</ul>
	</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
	<h3 id='p-tb-label'>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="/Special:WhatLinksHere/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="/Special:RecentChangesLinked/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-info"><a href="/index.php?title=Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
						</div>
					</div>
				</div>				
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk"><span><a href="/Talk:Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 id="p-variants-label"><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view"><span><a href="/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files" >View</a></span></li>
					<li id="ca-viewsource" class="selected"><span><a href="/index.php?title=Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="/index.php?title=Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">History</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 id="p-cactions-label"><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-createaccount"><a href="/index.php?title=Special:UserLogin&amp;returnto=Save+System%2C+Read+%26+Write+Any+Data+to+Compressed+Binary+Files&amp;returntoquery=action%3Dedit&amp;type=signup">Create account</a></li><li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Save+System%2C+Read+%26+Write+Any+Data+to+Compressed+Binary+Files&amp;returntoquery=action%3Dedit" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>	</ul>
</div>
				</div>
			</div>
		</div>
		<div id="maincol">
		<div class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<!-- Start of crumbs links -->
			<div class="crumbs">
			<p>
							</p>
			</div>
			<!-- End of crumbs links -->
			<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">View source for Save System, Read &amp; Write Any Data to Compressed Binary Files</span></h1>
			<div id="bodyContent">
				<div id="contentSub">← <a href="/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files" title="Save System, Read &amp; Write Any Data to Compressed Binary Files">Save System, Read &amp; Write Any Data to Compressed Binary Files</a></div>
																<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="/index.php?title=Epic_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Epic Wiki:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">{{Rating|Type=Article|Versions=(please verify)}}
=Custom Save System To Binary Files=

Original Author: [[User:Rama|Rama]] ([[User talk:Rama|talk]])

Dear Community,

'''Using what I explain in this tutorial you can write your own custom save systems wherein you'''

*write out literally any game-related data you want
*read back in this data any time you want, from hard-disk
*compress (ZLIB) these files to minimize usage of the end-user's computer hard disk space

I've already been writing out and loading back in levels that are zipped binary data files for my in-game editor.


'''I am currently able to save literally any custom data I want, including dynamic arrays, for all my custom classes.'''


I've developed a streamlined method for doing all this by overloading a specific UE4 C++ operator, so yay thank you thank you Epic for C++ access!



==Pre-Summary==

There's a lot of concepts in this tutorial, try out each part and get it working before moving on to the next

Just copy-pasting code will not work here, you need to understand the basics, because all I am presenting is the basics,

and you must apply the basics to your own project's needs.

After all, this is about a save system for any arbitrary project-specific custom class data :)



==Two Levels of Conversions==

When you want to save custom variable data for your custom save system,

there are TWO major steps involved

'''Step 1''' = variable format -> binary array (serialized by Archive class of UE4)

'''Step 2''' = Binary array -> hard disk

These steps are then done in reverse to read back in data from hard disk.



===Binary Array = TArray&lt;uint8>===

Binary data is represented in a very UE4 C++ friendly looking way as a dynamic array of uint8.

So any time you see TArray&lt;uint8> in my code in this tutorial, that literally means "Binary Array" from UE4 C++ standpoint.



===Step 1: Variable Format -> Binary Array===

An int32 takes up 4 bytes, as does a float.

An int64 takes up 8 bytes.

An FName takes up 8 bytes.

An FString takes up 16 bytes.

An FVector takes up 3 x float bytes.

etc.

So even a single int32 is actually an array of bytes, not a single entry.

Now let's suppose your save system needs to store

* 3 FVector's

* 40 int32's

* 20 FName's

Do all the math and this is a lot of bytes!

3 x 3 x 4  = 36

40 x 4 = 160

20 x 8 = 160 

356

So this means that before your data leaves UE4 and goes to hard disk, you need a TArray&lt;uint8> that has 356 entries.

===Step 2: Binary Array -> Hard Disk===

UE4 C++ gives you functions via FileManager.h to write out TArray&lt;uint8> to hard disk!



===Optional Step 3: Compressed Binary===

UE4 gives you functionality via Archive.h to compress a TArray&lt;uint8> before sending it to the FileManager

'''
C++ Code For You
'''

Below I am giving you the functions that I use to to read and write binary files of any custom data I choose

 
==Core Header Files==
===Archive.h and ArchiveBase.h===

See Archive.h and ArchiveBase.h for all the info you need about getting from your varibles and custom class data to binary format (serialized data).

===FileManager.h===

All the functions you need to 

*create directories
*delete directories
*create files
*delete files
*get a listing of all files in a given path
*get a listing of all folders in a given path
*get the age of a file

and more are found in FileManager.h

You access these functions from anywhere using

&lt;syntaxhighlight lang="cpp">
if(GFileManager) GFileManager->TheFunction()
&lt;/syntaxhighlight>

===BufferArchive===

The buffer archive is both a binary array (TArray&lt;uint8>), and a MemoryWriter

'''Archive.h'''

&lt;syntaxhighlight lang="cpp">
/**
 * Buffer archiver.
 */
class FBufferArchive : public FMemoryWriter, public TArray&lt;uint8>
{
&lt;/syntaxhighlight>

Because of this multiple-inheritance, the BufferArchive is my preferred way to write data to binary file.

As my code will show, because the GFileManager wants to receive a TArray&lt;uint8>, not a MemoryArchive.

Review my Steps 1 and 2 to see why this is such an awesome class. :)

Thanks UE4 Devs!



===FMemoryReader===

To read Data back from a binary array, that is retrieved by the FileManager, you need a MemoryReader

'''Archive.h'''

&lt;syntaxhighlight lang="cpp">
/**
 * Archive for reading arbitrary data from the specified memory location
 */
class FMemoryReader : public FMemoryArchive
{
public:
&lt;/syntaxhighlight>

==The &lt;&lt; Operator==

The BufferArchive/Binary Array needs to retrieve your game's variable data, how do you tell it what you want stored as binary?

The &lt;&lt; operator!


===Variable -> Binary===

Here's how you would put an FVector into a BufferArchive to then be saved to hard disk.

//in player controller class
&lt;syntaxhighlight lang="cpp">
FBufferArchive ToBinary;
ToBinary &lt;&lt; GetPawn()->GetActorLocation(); //save player location to hard disk

//save ToBinary to hard disk using File Manager, 
//see complete code samples below
&lt;/syntaxhighlight>

===Binary -> Variable===

Here's how you would retrieve an FVector from a TArray&lt;uint8> as retrieved by GFileManager.

&lt;syntaxhighlight lang="cpp">//TheBinaryArray was already obtained from FileManager, 
//see code below for full examples

//need to supply a variable to be filled with the data
FVector ToBeFilledWithData;

FMemoryReader Ar = FMemoryReader(TheBinaryArray, true); //true, free data after done
Ar.Seek(0); //make sure we are at the beginning

Ar &lt;&lt; ToBeFilledWithData;&lt;/syntaxhighlight>

==The Hardest Concept of UE4 C++ Custom Save System==

Compare these two lines

&lt;syntaxhighlight lang="cpp">
ToBinary &lt;&lt; GetPawn()->GetActorLocation();
Ar &lt;&lt; ToBeFilledWithData;
&lt;/syntaxhighlight>

The hardest concept for me about the UE4 archive system was the fact that the &lt;&lt; operator could mean

- getting data out of the archive and putting it into the variable

or

- putting data from the variable into the archived binary format

depending on the context!


So that's why I recommend you name your BufferArchive something like ToBinary,

and your MemoryReader something '''totally different''',

you can only discern the difference between writing to binary and reading from binary

based on the context as you show it in your code, as the &lt;&lt; operator will tell you nothing from a simple glance.



===Writing Your Function to Be Two-Way===

The critical advantage of this system though is that you can write a single function that works both ways.

So you can write a single function that loads data from file, or saves to file.

But why would you want this?

Because:

====The order of how you write out data to binary file must be the exact order that you read it back in!====


The computer does not have any way of knowing, nor does UE4, what the correct order of variable data should be.

You are responsible for telling the computer and UE4 to read data back in in the same order it was written out to file.

Thus, having a single function that both reads and writes, using the multi-purpose &lt;&lt; operator, is the safest thing you can do to ensure consistency of writing/reading binary data.

== ==
==SaveLoadData: Two-Way Save System Function==

&lt;syntaxhighlight lang="cpp">
'''.h'''

//FArchive is shared base class for FBufferArchive and FMemoryReader
void SaveLoadData(FArchive&amp; Ar, int32&amp; SaveDataInt32, FVector&amp; SaveDataVector, TArray&lt;FRotator>&amp; SaveDataRotatorArray);

'''.cpp'''

//I am using controller class for convenience, use any class you want

//SaveLoadData
void YourControllerClass::SaveLoadData(FArchive&amp; Ar,
  int32&amp; SaveDataInt32,
  FVector&amp; SaveDataVector,
  TArray&lt;FRotator>&amp; SaveDataRotatorArray
)
{
	Ar &lt;&lt; SaveDataInt32;
	Ar &lt;&lt; SaveDataVector;
	Ar &lt;&lt; SaveDataRotatorArray;
}
&lt;/syntaxhighlight>

===Saving===

Make a BufferArchive and pass it in, it is a Binary Array and also an FArchive

&lt;syntaxhighlight lang="cpp">
FBufferArchive ToBinary;
SaveLoadData(ToBinary,NumGemsCollected,PlayerLocation,ArrayOfRotationsOfTheStars);
//save the binary array / FBufferArchive to hard disk, see below
&lt;/syntaxhighlight>

===Loading===

&lt;syntaxhighlight lang="cpp">
// TheBinaryArray already retrieved from file, see full code sample
FMemoryReader FromBinary = FMemoryReader(TheBinaryArray, true); //true, free data after done
FromBinary.Seek(0);
SaveLoadData(FromBinary,NumGemsCollected,PlayerLocation,ArrayOfRotationsOfTheStars);
&lt;/syntaxhighlight>

===Summary===

Use this setup to avoid crashes due to reading data not in same order that you wrote it to disk!

this two way functionality of UE4 &lt;&lt; operator saves the day!

Thanks Epic Devs!

==My Binary Save System Functions For You==

Below I am giving you the functions that I use to save/load binary files!

===Saving Binary Files===

&lt;syntaxhighlight lang="cpp">
bool ControllerClass::SaveGameDataToFile(const FString&amp; FullFilePath, FBufferArchive&amp; ToBinary)
{
	//note that the supplied FString must be the entire Filepath
	// 	if writing it out yourself in C++ make sure to use the \\
	// 	for example:
	
	// 	FString SavePath = "C:\\MyProject\\MySaveDir\\mysavefile.save";
	
	//Step 1: Variable Data -> Binary
	
	//following along from above examples
	SaveLoadData(ToBinary,NumGemsCollected,PlayerLocation,ArrayOfRotationsOfTheStars); 
	//presumed to be global var data, 
	//could pass in the data too if you preferred

	//No Data
	if(ToBinary.Num() &lt;= 0) return false;
	//~
	
	//Step 2: Binary to Hard Disk
	if (FFileHelper::SaveArrayToFile(ToBinary, * FullFilePath)) 
	{
		// Free Binary Array 	
		ToBinary.FlushCache();
		ToBinary.Empty();
		
		ClientMessage("Save Success!");
		return true;
	}
	
	// Free Binary Array 	
	ToBinary.FlushCache();
	ToBinary.Empty();
	
	ClientMessage("File Could Not Be Saved!");
	
	return false;
}
&lt;/syntaxhighlight>

FBufferArchive

===Loading Binary Files===

&lt;syntaxhighlight lang="cpp">
//I am using the sample save data from above examples as the data being loaded
bool ControllerClass::LoadGameDataFromFile(
	const FString&amp; FullFilePath, 
	int32&amp; SaveDataInt32,
	FVector&amp; SaveDataVector,
	TArray&lt;FRotator>&amp; SaveDataRotatorArray
){
	//Load the data array,
	// 	you do not need to pre-initialize this array,
	//		UE4 C++ is awesome and fills it 
	//		with whatever contents of file are, 
	//		and however many bytes that is
	TArray&lt;uint8> TheBinaryArray;
	if (!FFileHelper::LoadFileToArray(TheBinaryArray, *FullFilePath))
	{
		ClientMessage("FFILEHELPER:>> Invalid File");
		return false;
		//~~
	}

	//Testing
	ClientMessage("Loaded File Size");
	ClientMessage(FString::FromInt(TheBinaryArray.Num()));
	
	//File Load Error
	if(TheBinaryArray.Num() &lt;= 0) return false;
	
	//~
	//		  Read the Data Retrieved by GFileManager
	//~
	
	FMemoryReader FromBinary = FMemoryReader(TheBinaryArray, true); //true, free data after done
	FromBinary.Seek(0);
	SaveLoadData(FromBinary,NumGemsCollected,PlayerLocation,ArrayOfRotationsOfTheStars);

	//~
	//								Clean up 
	//~
	FromBinary.FlushCache();
	
	// Empty &amp; Close Buffer 
	TheBinaryArray.Empty();
	FromBinary.Close();
	
	return true;
}
&lt;/syntaxhighlight>

===Saving Compressed===

&lt;syntaxhighlight lang="cpp">
bool ControllerClass::SaveGameDataToFileCompressed(const FString&amp; FullFilePath, 
	int32&amp; SaveDataInt32,
	FVector&amp; SaveDataVector,
	TArray&lt;FRotator>&amp; SaveDataRotatorArray
){
	FBufferArchive ToBinary;
	SaveLoadData(ToBinary,NumGemsCollected,PlayerLocation,ArrayOfRotationsOfTheStars); 
	
	//Pre Compressed Size
	ClientMessage("~ PreCompressed Size ~");
	ClientMessage(FString::FromInt(ToBinary.Num()));
	
	//
	
	// Compress File 
	//tmp compressed data array
	TArray&lt;uint8> CompressedData;
	FArchiveSaveCompressedProxy Compressor = 
		FArchiveSaveCompressedProxy(CompressedData, ECompressionFlags::COMPRESS_ZLIB);
	
	//Send entire binary array/archive to compressor
	Compressor &lt;&lt; ToBinary;
	
	//send archive serialized data to binary array
	Compressor.Flush();
	
	//
	
	//Compressed Size
	ClientMessage("~ Compressed Size ~");
	ClientMessage(FString::FromInt(CompressedData.Num()));
	
	
	if (!GFileManager) return false;
	
	//vibes to file, return successful or not
	if (FFileHelper::SaveArrayToFile(CompressedData, * FullFilePath)) 
	{
		// Free Binary Arrays 
		Compressor.FlushCache();
		CompressedData.Empty();
		
		ToBinary.FlushCache();
		ToBinary.Empty();
		
		// Close Buffer 
		ToBinary.Close();
		
		ClientMessage("File Save Success!");
		
		return true;
		//
	}
	else
	{
		// Free Binary Arrays 
                Compressor.FlushCache();
		CompressedData.Empty();

		ToBinary.FlushCache();
		ToBinary.Empty();
		
		// Close Buffer 
		ToBinary.Close();
		
		ClientMessage("File Could Not Be Saved!");
		
		return false;
		//
	}
}
&lt;/syntaxhighlight>



===Loading Compressed===

&lt;syntaxhighlight lang="cpp">

//I am using the sample save data from above examples as the data being loaded
bool ControllerClass::LoadGameDataFromFileCompressed(
	const FString&amp; FullFilePath, 
	int32&amp; SaveDataInt32,
	FVector&amp; SaveDataVector,
	TArray&lt;FRotator>&amp; SaveDataRotatorArray
){
	//Load the Compressed data array
	TArray&lt;uint8> CompressedData;
	if (!FFileHelper::LoadFileToArray(CompressedData, *FullFilePath))
	{
		Optimize("FFILEHELPER:>> Invalid File");
		return false;
		//~~
	}
	
	// Decompress File 
	FArchiveLoadCompressedProxy Decompressor = 
		FArchiveLoadCompressedProxy(CompressedData, ECompressionFlags::COMPRESS_ZLIB);
	
	//Decompression Error?
	if(Decompressor.GetError())
	{
		Optimize("FArchiveLoadCompressedProxy>> ERROR : File Was Not Compressed ");
		return false;
		//
	}
	
	//Decompress
	FBufferArchive DecompressedBinaryArray;
	Decompressor &lt;&lt; DecompressedBinaryArray;
	
	//~
	//		  Read the Data Retrieved by GFileManager
	//~
	
	FMemoryReader FromBinary = FMemoryReader(DecompressedBinaryArray, true); //true, free data after done
	FromBinary.Seek(0);
	SaveLoadData(FromBinary,NumGemsCollected,PlayerLocation,ArrayOfRotationsOfTheStars);

	//~
	//								Clean up 
	//~
	CompressedData.Empty();
	Decompressor.FlushCache();
	FromBinary.FlushCache();
	
	// Empty &amp; Close Buffer 
	DecompressedBinaryArray.Empty();
	DecompressedBinaryArray.Close();
	
	return true;
}
&lt;/syntaxhighlight>



== ==
==Overloading the &lt;&lt; Operator==

Create your own &lt;&lt; Operator overloads to simplify the process!

Let's say you have your own USTRUCT or your own class, and you want to write a way to

simply write

&lt;syntaxhighlight lang="cpp">ToBinary &lt;&lt; MyEntireSaveSystem;&lt;/syntaxhighlight>

or

&lt;syntaxhighlight lang="cpp">ToBinary &lt;&lt; MySpecialUStruct;&lt;/syntaxhighlight>


Here's how you overload the &lt;&lt; Operator!

Please note this must be in the .h file, and no contents in the .cpp.

Also there is no context, such as MyClass::, it must be at the global level.

Also the .h file that has this definition must be compiled before any classes that want to use it.

You can use UClass(dependson=UYourDefinitionsClass) to ensure this

or simply put the .h contents in your public directory

and include them as a header somewhere.

'''.h'''
&lt;syntaxhighlight lang="cpp">//Make as many Unique Overloads as you want!
FORCEINLINE FArchive&amp; operator&lt;&lt;(FArchive &amp;Ar, UMySaveGameClass* SaveGameData )
{
	if(!SaveGameData) return Ar;
	//~
	
	Ar &lt;&lt; SaveGameData->NumGemsCollected;  //int32
	Ar &lt;&lt; SaveGameData->PlayerLocation;  //FVector
	Ar &lt;&lt; SaveGameData->ArrayOfRotationsOfTheStars; //TArray&lt;FRotator>

        return Ar;
}&lt;/syntaxhighlight>

'''Note:'''
	
1. The operator is returning the Ar by reference.

2. No const are allowed at global level (its a compile error)

3. No const allowed inside because you dont know if you are reading or writing due to nature of &lt;&lt; operator.

==Crashes?==

If you get crashes you are not reading/writing data in same order,

use overloaded &lt;&lt; operator and the idea of a single function like SaveLoadGame to avoid this


Also, if you '''compress data before saving it''' make sure you are loading it using my '''compressed function''', not the regular one, and vice versa :)

==Enjoy!==

Have fun making your very own custom save game system, and saving it to compressed binary file!

♥

[[User:Rama|Rama]] ([[User talk:Rama|talk]])

[[Category:Tutorials]]
[[Category:Code]]
[[Category:Community Created Content]]
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Template used on this page:
</p></div><ul>
<li><a href="/Template:Rating" title="Template:Rating">Template:Rating</a> (<a href="/index.php?title=Template:Rating&amp;action=edit" title="Template:Rating">view source</a>) (protected)</li></ul></div><p id="mw-returnto">Return to <a href="/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files" title="Save System, Read &amp; Write Any Data to Compressed Binary Files">Save System, Read &amp; Write Any Data to Compressed Binary Files</a>.</p>
</div>												<div class="printfooter">
				Retrieved from "<a href="https://wiki.unrealengine.com/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files">https://wiki.unrealengine.com/Save_System,_Read_%26_Write_Any_Data_to_Compressed_Binary_Files</a>"				</div>
												<div id='catlinks' class='catlinks catlinks-allhidden'></div>												<div class="visualClear"></div>
							</div>
		</div>
		</div>
		</div>
		
		<div id="footer">
			<div id="brand">

			</div>
			<div id="legal">
				<div id="copyright">
					&copy; 2004-2015, Epic Games, Inc. All rights reserved. Unreal and its logo are Epic's trademarks or registered trademarks in the US and elsewhere.
				</div>
				<div id="terms">
					<a target="_blank" href="http://epicgames.com/tou">TERMS OF USE</a> | <a target="_blank" href="http://epicgames.com/privacynotice">PRIVACY POLICY</a>
				</div>
			</div>
		</div>
	</div>
		<!--<div id="footer" role="contentinfo">
										<ul id="footer-icons" class="noprint">
					<li id="footer-copyrightico">
						<div name="copyright">&#169; 2004-2014, Epic Games, Inc. All rights reserved. Epic Games, Unreal, Unreal Engine, Unreal Tournament, and their respective logos are Epic's trademarks or registered trademarks in the US and elsewhere.</div>
					</li>
					<li id="footer-termsofuseico">
						<div name="termsofuse"><a href="http://epicgames.com/tou" target="_blank">Terms of Use</a></div>
					</li>
					<li id="footer-privacynoticeico">
						<div name="privacynotice"><a href="http://epicgames.com/privacynotice" target="_blank">Privacy Policy</a></div>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>-->
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.edit.collapsibleFooter","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script src="/extensions/EpicSearchSystem/Javascript/Search.js?303"></script>
<script src="https://wiki.unrealengine.com/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=epic&amp;*"></script>
<!-- Served in 0.074 secs. -->		<img src="https://tracking.unrealengine.com/track.png" width="1" height="1">
		<!--<script type="text/javascript">
			setTimeout(function () {
				var a = document.createElement("script");
				var b = document.getElementsByTagName("script")[0];
				a.src = document.location.protocol + "//script.crazyegg.com/pages/scripts/0028/4572.js?" + Math.floor(new Date().getTime() / 3600000);
				a.async = true; a.type = "text/javascript"; b.parentNode.insertBefore(a, b)
			}, 1);
		</script>-->
	</body>
</html>

		