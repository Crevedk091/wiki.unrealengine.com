<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wiki.unrealengine.com</title>
    <meta name="description" content="A static site pulled from the internet archive">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css" as="style"><link rel="preload" href="/wiki.unrealengine.com/assets/js/app.aaf63946.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/2.4f53495e.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/929.c6f3de8e.js" as="script">
    <link rel="stylesheet" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki.unrealengine.com/" class="home-link router-link-active"><!----> <span class="site-name">wiki.unrealengine.com</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Profiling, How To Count CPU Cycles Of Specific Blocks Of Your Game Code - Epic Wiki</p> <h1 id="profiling-how-to-count-cpu-cycles-of-specific-blocks-of-your-game-code"><a href="#profiling-how-to-count-cpu-cycles-of-specific-blocks-of-your-game-code" class="header-anchor">#</a> Profiling, How To Count CPU Cycles Of Specific Blocks Of Your Game Code</h1> <h2 id="contents"><a href="#contents" class="header-anchor">#</a> Contents</h2> <ul><li><a href="#Overview">1 Overview</a> <ul><li><a href="#Pic_of_What_This_Wiki_Enables_You_To_Do">1.1 Pic of What This Wiki Enables You To Do</a></li></ul></li> <li><a href="#UE4_Documentation_on_Profiler">2 UE4 Documentation on Profiler</a> <ul><li><a href="#Running_The_UE4_Profiler">2.1 Running The UE4 Profiler</a></li> <li><a href="#Opening_Your_Profiled_Game_Session_Data_in_the_Editor">2.2 Opening Your Profiled Game Session Data in the Editor</a></li></ul></li> <li><a href="#Self">3 Self</a></li> <li><a href="#Creating_Your_Own_Stat_Group">4 Creating Your Own Stat Group</a></li> <li><a href="#Creating_the_Stat">5 Creating the Stat</a></li> <li><a href="#Using_the_Stat">6 Using the Stat</a></li> <li><a href="#Counting_CPU_Cycles_For_Any_Block_of_Code">7 Counting CPU Cycles For Any Block of Code</a></li> <li><a href="#Example_From_My_Code_Base">8 Example From My Code Base</a></li> <li><a href="#Conclusion">9 Conclusion</a></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p><strong>Author:</strong> <a href="/User:Rama" title="User:Rama">Rama</a> (<a href="/User_talk:Rama" title="User talk:Rama">talk</a>)</p> <p>In this wiki I show you how you can count the CPU cycles of individual blocks of your game code, and expose this information to a very easy-to-use UI in the UE4 Editor!</p> <p>This wiki shows you how to leverage all the work Epic engineers have put into the UE4 profiler, customizing it to monitor named sections of your game code!</p> <p>After you're done with this wiki you will be able to check on the performance of any individual lines or functions from your entire project-level code base, assigning your own chosen names to these blocks of code!</p> <p>Enjoy!</p> <p>Rama</p> <h3 id="pic-of-what-this-wiki-enables-you-to-do"><a href="#pic-of-what-this-wiki-enables-you-to-do" class="header-anchor">#</a> Pic of What This Wiki Enables You To Do</h3> <p>In this picture you can see I've created my own custom STAT so that the UE4 Profiler can track a specific block of my game code that I called <strong>&quot;Joy ~ PerformSphereMovement&quot;</strong>.</p> <p>I've successfully tracked the CPU cycles of a section of my own project-level code base and exposed this information to the very friendly GUI of the UE4 Profiler!</p> <p>Yay!</p> <p>This picture shows that the UE4 Profiler has confirmed my guess that a certain block of my code was causing almost 97% (96.6) of the performance hit for all the character tick code in my entire code base!</p> <p>It saves me hours of time to be able to easily narrow down what block of code in my rather large character code base is causing <strong>literally 97% of the character-code performance hit!</strong></p> <p><a href="/File:WeHaveOurOwnStatsNow.jpg"><img src="https://d3ar1piqh1oeli.cloudfront.net/d/d6/WeHaveOurOwnStatsNow.jpg/1000px-WeHaveOurOwnStatsNow.jpg" alt="WeHaveOurOwnStatsNow.jpg"></a></p> <h2 id="ue4-documentation-on-profiler"><a href="#ue4-documentation-on-profiler" class="header-anchor">#</a> UE4 Documentation on Profiler</h2> <p>I assume you are familiar with the basics of the UE4 profiler in this tutorial.</p> <p>If you have not yet seen what the profiler can already do for you, I recommend reading the Epic Documentation and trynig it out!</p> <p><a href="https://docs.unrealengine.com/latest/INT/Engine/Performance/Profiler/index.html" target="_blank" rel="noopener noreferrer">Epic Documentation on the Amazing UE4 Profiler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>I will however cover a few basics on using the profile to get you up and running:</p> <h3 id="running-the-ue4-profiler"><a href="#running-the-ue4-profiler" class="header-anchor">#</a> Running The UE4 Profiler</h3> <p>Type in the in-game console to Start Profile:</p> <p>&quot;stat startfile&quot;;</p> <p>Type in the in-game console To Stop Profile</p> <p>&quot;stat stopfile&quot;;</p> <h3 id="opening-your-profiled-game-session-data-in-the-editor"><a href="#opening-your-profiled-game-session-data-in-the-editor" class="header-anchor">#</a> Opening Your Profiled Game Session Data in the Editor</h3> <p>Go to Window-&gt;Developer Tools-&gt;Session Front End</p> <p>Then click on the profiler button!</p> <p><a href="/File:SessionFrontProfiler.jpg"><img src="https://d3ar1piqh1oeli.cloudfront.net/a/af/SessionFrontProfiler.jpg/900px-SessionFrontProfiler.jpg" alt="SessionFrontProfiler.jpg"></a></p> <p>Then you can load your file that you saved!</p> <p>It will be under the Saved/Profiling directoryÂ ðŸ˜ƒ</p> <p>Always check the date to make sure you are looking at the right file!</p> <h2 id="self"><a href="#self" class="header-anchor">#</a> Self</h2> <p>Now on to the core of this wiki!</p> <p>You'll notice that in your game code there will be huge blocks called &quot;Self&quot; which indicates code that has not been divided up into cycle-counted sub-sections! This Self block is all of the code running for your in-game class instances.</p> <p>Well here is how you can sub-divide Self into your own chosen named categories, neatly organizing and cateloging your own code base!</p> <h2 id="creating-your-own-stat-group"><a href="#creating-your-own-stat-group" class="header-anchor">#</a> Creating Your Own Stat Group</h2> <p>Let's say you have class hierachy of classes for your in-game Character.</p> <p>You want to subdivide the inner workings of your entire character code into CPU cycle-counted code blocks.</p> <p>In the highest level of your class structure, in the .h, declare your category</p> <p>//For UE4 Profiler ~ Stat Group
DECLARE_STATS_GROUP(TEXT(&quot;JoyBall&quot;), STATGROUP_JoyBall, STATCAT_Advanced);</p> <h2 id="creating-the-stat"><a href="#creating-the-stat" class="header-anchor">#</a> Creating the Stat</h2> <p>In the .cpp where you want to track a particular function body, put this at the top just below the #includes</p> <p>/*
Â 
By Rama
Â 
*/
#include &quot;Joy.h&quot;
#include &quot;JoyBall.h&quot;
Â 
//For UE4 Profiler ~ Stat
DECLARE_CYCLE_STAT(TEXT(&quot;Joy ~ PerformSphereMovement&quot;), STAT_PerformSphereMovement, STATGROUP_JoyBall);</p> <p>Please note you can create as many CYCLE_STAT's as you want for your particular STATGROUPÂ !</p> <p>And you should have one DECLARE_CYCLE_STAT for each function body/scope that you want to count cycles for</p> <h2 id="using-the-stat"><a href="#using-the-stat" class="header-anchor">#</a> Using the Stat</h2> <p>At the very top of the scope of the function you want to track, put the SCOPE macro. Everything within the brackets of the scope you put the SCOPE_CYCLE_COUNTER in will be cycle-counted by the profiler!</p> <p>void AJoyBallMovement::PerformSphereMovement()
{
SCOPE_CYCLE_COUNTER(STAT_PerformSphereMovement);
Â 
//... your code that you want to test the performance of and have show up in the profiler
Â 
} //Cycle count scope ends here -Rama</p> <h2 id="counting-cpu-cycles-for-any-block-of-code"><a href="#counting-cpu-cycles-for-any-block-of-code" class="header-anchor">#</a> Counting CPU Cycles For Any Block of Code</h2> <p>Please note your scope can be within a single function, just make sure to give such a stat an appropriate name like YourFunction_Internal or something Again, the SCOPE_CYCLE_COUNTER will cycle-count within its brackets</p> <p>void AJoyBallMovement::PerformSphereMovement()
{
//First part of this function, code that wont be cycle counted
ConsoleCommand(&quot;Joy&quot;);
//... etc
Â 
//You can scope any lines of code you want by adding brackets!
{
SCOPE_CYCLE_COUNTER(STAT_PerformSphereMovement);
int32 Parameter = 200;
YourFunctionThatYouThinkMightBeSlow(Parameter);
//other code to cycle count
Â 
} //Cycle count scope ends here -Rama
Â 
Â 
//More code that wont be cycle counted
ConsoleCommand(&quot;~~~~~&quot;);
//... etc
}</p> <h2 id="example-from-my-code-base"><a href="#example-from-my-code-base" class="header-anchor">#</a> Example From My Code Base</h2> <p>See the picture in the overview!</p> <p>In my own code base I had a 10 class inheritance hierarchy for my game character, and the UE4 profiler was simply telling me that the character &quot;Self&quot; was costing 37% of my total performance hit.</p> <p>I used the info I am sharing with you in this wiki to create a SCOPE_CYCLE_COUNTER for the function that I thought was probably taking all the performance, and I was right!</p> <p>But the most important thing is that I enabled the awesome UE4 Profiler to help me narrow down the performance hit in my game code to just a single function / block of code, and so with that info I can easily address the performance hit, knowing it is worth the effort to rewrite the code!</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>You now know how you can CPU cycle-count individual lines of your game code base, and expose this information to UE4's super awesome GUI Profiler!</p> <p>Enjoy!</p> <p><a href="/User:Rama" title="User:Rama">Rama</a> (<a href="/User_talk:Rama" title="User talk:Rama">talk</a>)</p> <p>Retrieved from &quot;<a href="https://wiki.unrealengine.com/index.php?title=Profiling,_How_To_Count_CPU_Cycles_Of_Specific_Blocks_Of_Your_Game_Code&amp;oldid=13627" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/index.php?title=Profiling,_How_To_Count_CPU_Cycles_Of_Specific_Blocks_Of_Your_Game_Code&amp;oldid=13627<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;</p> <p><a href="/Special:Categories" title="Special:Categories">Category</a>:</p> <ul><li><a href="/Category:Code" title="Category:Code">Code</a></li></ul> <p><img src="https://tracking.unrealengine.com/track.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wiki.unrealengine.com/assets/js/app.aaf63946.js" defer></script><script src="/wiki.unrealengine.com/assets/js/2.4f53495e.js" defer></script><script src="/wiki.unrealengine.com/assets/js/929.c6f3de8e.js" defer></script>
  </body>
</html>
