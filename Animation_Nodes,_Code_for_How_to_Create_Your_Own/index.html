<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wiki.unrealengine.com</title>
    <meta name="description" content="A static site pulled from the internet archive">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css" as="style"><link rel="preload" href="/wiki.unrealengine.com/assets/js/app.aaf63946.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/2.4f53495e.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/73.ef1e6f47.js" as="script">
    <link rel="stylesheet" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki.unrealengine.com/" class="home-link router-link-active"><!----> <span class="site-name">wiki.unrealengine.com</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Animation Nodes, Code for How to Create Your Own - Epic Wiki</p> <h1 id="animation-nodes-code-for-how-to-create-your-own"><a href="#animation-nodes-code-for-how-to-create-your-own" class="header-anchor">#</a> Animation Nodes, Code for How to Create Your Own</h1> <h2 id="contents"><a href="#contents" class="header-anchor">#</a> Contents</h2> <ul><li><a href="#Overview">1 Overview</a></li> <li><a href="#Complete_Custom_Animation_Code_Example">2 Complete Custom Animation Code Example</a></li> <li><a href="#Class_to_Extend_AnimNode_Base">3 Class to Extend AnimNode_Base</a> <ul><li><a href="#.h">3.1 .h</a></li> <li><a href="#.cpp">3.2 .cpp</a></li></ul></li> <li><a href="#Key_Concepts_of_Animation_Nodes">4 Key Concepts of Animation Nodes</a></li> <li><a href="#Animation_Update">5 Animation Update</a></li> <li><a href="#Animation_Evaluate">6 Animation Evaluate</a></li> <li><a href="#AnimGraph_Node">7 AnimGraph Node</a> <ul><li><a href="#.h_2">7.1 .h</a></li> <li><a href="#.cpp_2">7.2 .cpp</a></li></ul></li> <li><a href="#Summary">8 Summary</a></li> <li><a href="#UE4_Source_References">9 UE4 Source References</a></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>Dear Community,</p> <p>In this tutorial I explain the very basics of making your own custom animation node.</p> <p>My main goal is to help you establish the basic structure to then pursue your individual animation node goals on your ownÂ ðŸ˜ƒ</p> <p>This is not a tutorial for creating skeletal controllers, but rather animation blends of one kind or anotherÂ ðŸ˜ƒ</p> <h2 id="complete-custom-animation-code-example"><a href="#complete-custom-animation-code-example" class="header-anchor">#</a> Complete Custom Animation Code Example</h2> <p>I have my entire source code for a custom animation node, Editor Graph Node included, here!</p> <p><strong><a href="/Animation_Node,_Entire_Source_for_a_Turn_In_Place_Node" title="Animation Node, Entire Source for a Turn In Place Node">Custom Turn in Place Animation Node</a></strong></p> <h2 id="class-to-extend-animnode-base"><a href="#class-to-extend-animnode-base" class="header-anchor">#</a> Class to Extend AnimNode_Base</h2> <p>Here is the basic setup you need, .h and .cpp, for the node itself</p> <p>This node is a struct that is wrapped in the editor animgraph node that is what you are used to seeingÂ ðŸ˜ƒ</p> <h3 id="h"><a href="#h" class="header-anchor">#</a> .h</h3> <p>// Copyright 1998-2013 Epic Games, Inc. All Rights Reserved.
Â 
#pragma once
#include &quot;AnimNode_NameOfYourNode.generated.h&quot;
Â 
USTRUCT()
struct FAnimNode_NameOfYourNode : public FAnimNode_Base
{
GENERATED_USTRUCT_BODY()
Â 
//FPoseLink - this can be any combination
//of other nodes, not just animation sequences
//	so you could have an blend space leading into
//a layer blend per bone to just use the arm
//	and then pass that into the PoseLink
Â 
/** Base Pose - This Can Be Entire Anim Graph Up To This Point, or Any Combination of Other Nodes*/
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category=Links)
FPoseLink BasePose;
Â 
/** Other Pose! - This Can Be Entire Anim Graph Up To This Point, or Any Combination of Other Nodes */
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category=Links)
FPoseLink OtherPose;
Â 
/** Sample Property That Will Show Up as a Pin */
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category=Links, meta=(PinShownByDefault))
float SampleFloat;
Â 
// FAnimNode_Base interface
public:
Â 
// FAnimNode_Base interface
virtual void Initialize(const FAnimationInitializeContext&amp; Context) OVERRIDE;
virtual void CacheBones(const FAnimationCacheBonesContext &amp; Context) OVERRIDE;
virtual void Update(const FAnimationUpdateContext &amp; Context) OVERRIDE;
virtual void Evaluate(FPoseContext&amp; Output) OVERRIDE;
// End of FAnimNode_Base interface
Â 
// Constructor
public:
Â 
FAnimNode_NameOfYourNode();
Â 
protected:
bool WorldIsGame;
AActor* OwningActor;
};</p> <h3 id="cpp"><a href="#cpp" class="header-anchor">#</a> .cpp</h3> <p>// Copyright 1998-2013 Epic Games, Inc. All Rights Reserved.
Â 
#include &quot;YourGame.h&quot;
Â 
//#include &quot;AnimationRuntime.h&quot;
Â 
FAnimNode_NameOfYourNode::FAnimNode_NameOfYourNode()
: FAnimNode_Base()
, SampleFloat(128.333)
{
WorldIsGame = false;
}
Â 
void FAnimNode_NameOfYourNode::Initialize(const FAnimationInitializeContext &amp; Context)
{
//Init the Inputs
BasePose.Initialize(Context);
OtherPose.Initialize(Context);
Â 
//Get the Actor Owner
OwningActor = Context.AnimInstance-&gt; GetSkelMeshComponent()-&gt;GetOwner();
Â 
//Editor or Game?
UWorld * TheWorld = Context.AnimInstance-&gt;GetWorld();
if (!TheWorld) return;
//~
Â 
WorldIsGame = (TheWorld-&gt;WorldType == EWorldType::Game);
}
Â 
void FAnimNode_NameOfYourNode::CacheBones(const FAnimationCacheBonesContext &amp; Context)
{
BasePose.CacheBones(Context);
OtherPose.CacheBones(Context);
}
void FAnimNode_NameOfYourNode::Update(const FAnimationUpdateContext &amp; Context)
{
//***************************************
// Evaluate Graph, see AnimNode_Base, AnimNodeBase.h
EvaluateGraphExposedInputs.Execute(Context);
//***************************************
Â 
//EDITOR
//Editor mode? just use the base pose
if (!WorldIsGame)
{
//if your node depends on
//actual actor instance, can't do anything in editor
}
Â 
//GAME
//Actually in Game so the Owner Instance Should Exist
else
{
//Try Again if not found
if (!OwningActor) OwningActor =
Context.AnimInstance-&gt;GetSkelMeshComponent()-&gt;GetOwner();
Â 
//Not found
if (!OwningActor)
{
UE_LOG(LogAnimation, Warning,
TEXT(&quot;FAnimNode_NameOfYourNode::Update() Owning Actor was not found&quot;));
return;
//~
}
Â 
//Do Stuff Based On Actor Owner
}
//~~
Â 
// Do Updates
Â 
//Try To Update As Few of the Inputs As You Can
Â 
//************************************************
// FPoseLinkBase::Update Active Pose - this is what makes
//the glowing line thing happen and animations loop
//***********************************************
BasePose.Update(Context);
Â 
Â 
Â 
}
Â 
void FAnimNode_NameOfYourNode::Evaluate(FPoseContext &amp; Output)
{
// Return Base Pose, Un Modified
BasePose.Evaluate(Output);
Â 
//Evaluate is returning the Output to this function,
//which is returning the Output to the rest of the Anim Graph
Â 
//In this case, we are passing the Output out variable into the BasePose
Â 
//Basically saying, give us back the unmodified Base Pose
Â 
//i.e, the bulk of your anim tree.
}</p> <h2 id="key-concepts-of-animation-nodes"><a href="#key-concepts-of-animation-nodes" class="header-anchor">#</a> Key Concepts of Animation Nodes</h2> <p>There is an initialize, an update, and an evaluate</p> <p>Initialize = make sure to initialize the inputs!</p> <p>BasePose.Initialize(Context);
OtherPose.Initialize(Context);</p> <h2 id="animation-update"><a href="#animation-update" class="header-anchor">#</a> Animation Update</h2> <p>Make sure to actually &quot;tick&quot; the inputs of your choice!</p> <p>BasePose.Update(Context);</p> <p>Try to update as few of the inputs as you can, based on the logic of your anim node.</p> <p>For example if you were blending between A and B and you were fully blended to B, you would not need to update A at all</p> <p>But if you were at 0.5 in between you'd have to update both.</p> <p>If you don't update any poses then the graph lines will not glow.</p> <h2 id="animation-evaluate"><a href="#animation-evaluate" class="header-anchor">#</a> Animation Evaluate</h2> <p>Pass out the results of all your calculations and updates as the output to the rest of the Anim Graph</p> <p>The Output variable is the entire output of all your anim nodes activities</p> <p>BasePose.Evaluate(Output);</p> <p>You can do much more complicated things than just evaluate the base or the other poses</p> <p>The key data of Output is Output.Pose, which is an FA2Pose data, which is animation data that could be calculated any number of ways.</p> <p>As long as you update Output.Pose you can do all sorts of things</p> <p>)</p> <h2 id="animgraph-node"><a href="#animgraph-node" class="header-anchor">#</a> AnimGraph Node</h2> <p>Here is the basic .h and .cpp you need for making the in-editor anim graph visual representation of your node</p> <h3 id="h-2"><a href="#h-2" class="header-anchor">#</a> .h</h3> <p>// Copyright 1998-2013 Epic Games, Inc. All Rights Reserved.
Â 
#pragma once
Â 
#include &quot;AnimGraphDefinitions.h&quot;
#include &quot;Kismet2/BlueprintEditorUtils.h&quot;
Â 
#include &quot;AnimGraphNode_NameOfYourNode.generated.h&quot;
Â 
//Whole point of this is to be wrapper for node struct
//	so it depends on it, and that node must compile first
//	for type to be recognized
Â 
UCLASS(MinimalAPI, dependson=FAnimNode_NameOfYourNode)
class UAnimGraphNode_NameOfYourNode : public UAnimGraphNode_Base
{
GENERATED_UCLASS_BODY()
Â 
UPROPERTY(EditAnywhere, Category=Settings)
FAnimNode_NameOfYourNode Node;
Â 
public:
// UEdGraphNode interface
virtual FString GetNodeTitle(ENodeTitleType::Type TitleType) const OVERRIDE;
virtual FLinearColor GetNodeTitleColor() const OVERRIDE;
virtual FString GetNodeCategory() const OVERRIDE;
// End of UEdGraphNode interface
Â 
protected:
virtual FString GetControllerDescription() const;
Â 
};</p> <h3 id="cpp-2"><a href="#cpp-2" class="header-anchor">#</a> .cpp</h3> <p>// Copyright 1998-2013 Epic Games, Inc. All Rights Reserved.
Â 
#include &quot;YourGame.h&quot;
Â 
/////////////////////////////////////////////////////
// UAnimGraphNode_NameOfYourNode
Â 
UAnimGraphNode_NameOfYourNode::UAnimGraphNode_NameOfYourNode(const FPostConstructInitializeProperties&amp; PCIP)
: Super(PCIP)
{
}
Â 
//Title Color!
FLinearColor UAnimGraphNode_NameOfYourNode::GetNodeTitleColor() const
{
return FLinearColor(0,12,12,1);
}
Â 
//Node Category
FString UAnimGraphNode_NameOfYourNode::GetNodeCategory() const
{
return FString(&quot;Anim Node Category&quot;);
}
FString UAnimGraphNode_NameOfYourNode::GetControllerDescription() const
{
return TEXT(&quot; Your Anim node Title &quot;);
}
Â 
FString UAnimGraphNode_NameOfYourNode::GetNodeTitle(ENodeTitleType::Type TitleType) const
{
FString Result = *GetControllerDescription();
Result += (TitleType == ENodeTitleType::ListView) ? TEXT(&quot;&quot;) : TEXT(&quot;\n&quot;);
return Result;
}</p> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <p>With these basics and reviewing the different animation data types you are well on your way to making your own animatoion node!</p> <h2 id="ue4-source-references"><a href="#ue4-source-references" class="header-anchor">#</a> UE4 Source References</h2> <p>See these .h files for lots of important info</p> <p>AnimNodeBase.h
AnimationAssets.h
AnimInstance.h</p> <p>Enjoy!</p> <p><a href="/User:Rama" title="User:Rama">Rama</a> (<a href="/User_talk:Rama" title="User talk:Rama">talk</a>)</p> <p>Retrieved from &quot;<a href="https://wiki.unrealengine.com/index.php?title=Animation_Nodes,_Code_for_How_to_Create_Your_Own&amp;oldid=4485" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/index.php?title=Animation_Nodes,_Code_for_How_to_Create_Your_Own&amp;oldid=4485<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;</p> <p><a href="/Special:Categories" title="Special:Categories">Category</a>:</p> <ul><li><a href="/Category:Code" title="Category:Code">Code</a></li></ul> <p><img src="https://tracking.unrealengine.com/track.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wiki.unrealengine.com/assets/js/app.aaf63946.js" defer></script><script src="/wiki.unrealengine.com/assets/js/2.4f53495e.js" defer></script><script src="/wiki.unrealengine.com/assets/js/73.ef1e6f47.js" defer></script>
  </body>
</html>
