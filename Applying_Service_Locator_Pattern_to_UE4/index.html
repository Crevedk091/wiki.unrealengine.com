<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wiki.unrealengine.com</title>
    <meta name="description" content="A static site pulled from the internet archive">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css" as="style"><link rel="preload" href="/wiki.unrealengine.com/assets/js/app.aaf63946.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/2.4f53495e.js" as="script"><link rel="preload" href="/wiki.unrealengine.com/assets/js/95.9a388be2.js" as="script">
    <link rel="stylesheet" href="/wiki.unrealengine.com/assets/css/0.styles.b0e83839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki.unrealengine.com/" class="home-link router-link-active"><!----> <span class="site-name">wiki.unrealengine.com</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Applying Service Locator Pattern to UE4 - Epic Wiki</p> <h1 id="applying-service-locator-pattern-to-ue4"><a href="#applying-service-locator-pattern-to-ue4" class="header-anchor">#</a> Applying Service Locator Pattern to UE4</h1> <h2 id="contents"><a href="#contents" class="header-anchor">#</a> Contents</h2> <ul><li><a href="#Overview">1 Overview</a></li> <li><a href="#What_Is_a_Service_Locator">2 What Is a Service Locator</a></li> <li><a href="#Where_is_it_useful_in_UE4">3 Where is it useful in UE4</a></li> <li><a href="#Implementation">4 Implementation</a> <ul><li><a href="#Creating_the_Service_Locator_class">4.1 Creating the Service Locator class</a> <ul><li><a href="#ServiceLocator.h">4.1.1 ServiceLocator.h</a></li> <li><a href="#ServiceLocator.cpp">4.1.2 ServiceLocator.cpp</a></li></ul></li> <li><a href="#Instantiation">4.2 Instantiation</a> <ul><li><a href="#.h">4.2.1 .h</a></li> <li><a href="#.cpp">4.2.2 .cpp</a></li></ul></li> <li><a href="#Supporting_a_Service">4.3 Supporting a Service</a> <ul><li><a href="#ServiceLocator.h_2">4.3.1 ServiceLocator.h</a></li> <li><a href="#ServiceLocator.cpp_2">4.3.2 ServiceLocator.cpp</a></li></ul></li> <li><a href="#Usage">4.4 Usage</a> <ul><li><a href="#Setting">4.4.1 Setting</a></li> <li><a href="#Getting">4.4.2 Getting</a></li></ul></li></ul></li> <li><a href="#Summary">5 Summary</a></li></ul> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>This article draws heavily from Bob Nystrom's website and book <a href="http://gameprogrammingpatterns.com" target="_blank" rel="noopener noreferrer">Game Programming Patterns<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and more specifically the chapter on <a href="http://gameprogrammingpatterns.com/service-locator.html" target="_blank" rel="noopener noreferrer">Service Locators<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. I simply describe how to implement the simplest form of this pattern with a few UE4 considerations.</p> <h2 id="what-is-a-service-locator"><a href="#what-is-a-service-locator" class="header-anchor">#</a> What Is a Service Locator</h2> <p>The <a href="http://gameprogrammingpatterns.com/service-locator.html" target="_blank" rel="noopener noreferrer">Service Locator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> pattern is a substitution and extension on a traditional Singleton Pattern. It contains static references to single instances of a several classes. Unlike a Singleton, the static reference resides outside of its class, existing in a kind of &quot;middle man&quot; class. This allows the reference to change at runtime while still allowing global access. It collects all static references into one place so that they're more easily managed by the programmer.</p> <h2 id="where-is-it-useful-in-ue4"><a href="#where-is-it-useful-in-ue4" class="header-anchor">#</a> Where is it useful in UE4</h2> <p>Just like Singletons, this pattern should be used sparingly. I found Singletons in UE4 had their own dangers when implemented incorrectly. Static class instances don't support UPROPERTY and therefor it can't be guaranteed that the object wouldn't be garbage collected and disappear. This can be worked around by adding a non-static reference within the the instance to &quot;hold&quot; onto the object. However, I found it easier to consolidate this workaround into a single Service Locator instead of littering potentially unused variables around different classes.</p> <h2 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h2> <h3 id="creating-the-service-locator-class"><a href="#creating-the-service-locator-class" class="header-anchor">#</a> Creating the Service Locator class</h3> <p>Create an empty class like the one described below. Personally I keep it within its own &quot;servicelocator&quot; namespace. Notice how there is a static &quot;Instance&quot; variable, this is used by the static methods within the Service Locator later on to keep provided services in memory via UPROPERTY.</p> <p>The Service Locator must extend UObject if the instances it stores are going to be properly managed by UE4.</p> <p>Replace <YourProject> with the header of your game.</YourProject></p> <h4 id="servicelocator-h"><a href="#servicelocator-h" class="header-anchor">#</a> ServiceLocator.h</h4> <p>#pragma once
#include &quot;ServiceLocator.generated.h&quot;
 
UCLASS()
class UServiceLocator : public UObject
{
GENERATED_BODY()
 
public:
UServiceLocator(const FObjectInitializer&amp; ObjectInitializer);
private:
static UServiceLocator* Instance;
};</p> <h4 id="servicelocator-cpp"><a href="#servicelocator-cpp" class="header-anchor">#</a> ServiceLocator.cpp</h4> <p>#include &quot;<YourProject>.h&quot;
#include &quot;ServiceLocator.h&quot;
 
UServiceLocator* UServiceLocator::Instance;
 
UServiceLocator::UServiceLocator(const FObjectInitializer&amp; ObjectInitializer)
: Super(ObjectInitializer)
{
UServiceLocator::Instance = this;
}</YourProject></p> <h3 id="instantiation"><a href="#instantiation" class="header-anchor">#</a> Instantiation</h3> <p>The Service Locator must be created before any services are provided. I use a custom UGameInstance class and the overrided function Init(). This can be placed anywhere, as long as it's before any usage of the Service Locator and must be kept in memory for as long as you want to be able to access the services.</p> <h4 id="h"><a href="#h" class="header-anchor">#</a> .h</h4> <p>private:
//Holds the ServiceLocator in memory for the duration of the game using UPROPERTY
UPROPERTY()
UServiceLocator* ServiceLocator;</p> <h4 id="cpp"><a href="#cpp" class="header-anchor">#</a> .cpp</h4> <p>//Create an instance of the ServiceLocator and hold it in memory
ServiceLocator = ConstructObject&lt;UServiceLocator&gt;(UServiceLocator::StaticClass());</p> <h3 id="supporting-a-service"><a href="#supporting-a-service" class="header-anchor">#</a> Supporting a Service</h3> <p>Following Bob Nystrom's example lets say we have a fictional Audio service that needs to be called from multiple different points across the game. Add static methods and reference for any services you wish to provide.</p> <p>Note that there is a static and non-static copy of the service. The non-static copy is used by UE4's reflection system and UPROPERTY, this is what keeps the object's memory managed.</p> <h4 id="servicelocator-h-2"><a href="#servicelocator-h-2" class="header-anchor">#</a> ServiceLocator.h</h4> <p>#pragma once
#include &quot;ServiceLocator.generated.h&quot;
 
UCLASS()
class UServiceLocator : public UObject
{
GENERATED_BODY()
 
public:
UServiceLocator(const FObjectInitializer&amp; ObjectInitializer);
 
static UAudio* GetAudio() { return AudioService_; }
 
static void ProvideAudio(UAudio* service)
{
AudioService_ = service;
Instance-&gt;AudioService = service;
}
private:
static UServiceLocator* Instance;
 
// Static References
static UAudio* AudioService_;
 
// UE4 UProperty references in the instance, used to maintain memory management and are otherwise unused.
UPROPERTY()
UAudio* AudioService;
};</p> <h4 id="servicelocator-cpp-2"><a href="#servicelocator-cpp-2" class="header-anchor">#</a> ServiceLocator.cpp</h4> <p>#include &quot;<YourProject>.h&quot;
#include &quot;ServiceLocator.h&quot;
 
UServiceLocator* UServiceLocator::Instance;
 
UAudio* UServiceLocator::AudioService_;
 
UServiceLocator::UServiceLocator(const FObjectInitializer&amp; ObjectInitializer)
: Super(ObjectInitializer)
{
UServiceLocator::Instance = this;
}</YourProject></p> <p>There must be an implementation of AudioService_ in the .cpp file to avoid compiler errors.</p> <h3 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h3> <h4 id="setting"><a href="#setting" class="header-anchor">#</a> Setting</h4> <p>To set the service to be retrieved later create the UObject with UE4's ConstructObject functionality and pass it to the Service Locator.</p> <p>UAudio* AudioService = ConstructObject&lt;UAudio&gt;(UAudio::StaticClass());
UServiceLocator::ProvideAudio(AudioService);</p> <h4 id="getting"><a href="#getting" class="header-anchor">#</a> Getting</h4> <p>To retrieve the service simply call the UServiceLocator from anywhere!</p> <p>UServiceLocator::GetAudio()</p> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <p>Sometimes it's appropriate to use static references to different parts of your game. This application allows for flexibility and contains all of the static references for your module in one location. Used lightly it can empower and simplify your code, but if your Service Locator is managing an increasing list of services that may be a warning sign to rethink a few things.</p> <p>Enjoy and good luck!</p> <p>Retrieved from &quot;<a href="https://wiki.unrealengine.com/index.php?title=Applying_Service_Locator_Pattern_to_UE4&amp;oldid=12826" target="_blank" rel="noopener noreferrer">https://wiki.unrealengine.com/index.php?title=Applying_Service_Locator_Pattern_to_UE4&amp;oldid=12826<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>&quot;</p> <p><a href="/Special:Categories" title="Special:Categories">Categories</a>:</p> <ul><li><a href="/Category:Tutorials" title="Category:Tutorials">Tutorials</a></li> <li><a href="/Category:Code" title="Category:Code">Code</a></li></ul> <p><img src="https://tracking.unrealengine.com/track.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wiki.unrealengine.com/assets/js/app.aaf63946.js" defer></script><script src="/wiki.unrealengine.com/assets/js/2.4f53495e.js" defer></script><script src="/wiki.unrealengine.com/assets/js/95.9a388be2.js" defer></script>
  </body>
</html>
